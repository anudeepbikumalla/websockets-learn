<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Lesson 28 ‚Äî Deployment</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Fira+Code:wght@400;500&display=swap"
    rel="stylesheet" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box
    }

    :root {
      --bg: #0a0d16;
      --card: #111827;
      --card2: #1a2235;
      --card3: #0d1525;
      --border: #1f2d45;
      --text: #e2e8f0;
      --muted: #64748b;
      --dim: #94a3b8;
      --green: #22c55e;
      --blue: #38bdf8;
      --yellow: #fbbf24;
      --red: #f87171;
      --purple: #a78bfa
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6
    }

    .hero {
      text-align: center;
      padding: 56px 24px 40px;
      background: radial-gradient(ellipse 80% 60% at 50% 0%, rgba(34, 197, 94, .07), transparent);
      border-bottom: 1px solid var(--border)
    }

    .badge {
      display: inline-block;
      background: rgba(34, 197, 94, .1);
      color: var(--green);
      border: 1px solid rgba(34, 197, 94, .2);
      border-radius: 99px;
      padding: 4px 14px;
      font-size: .75rem;
      font-weight: 600;
      letter-spacing: 1px;
      text-transform: uppercase;
      margin-bottom: 18px
    }

    h1 {
      font-size: clamp(1.8rem, 5vw, 3rem);
      font-weight: 800;
      margin-bottom: 12px;
      background: linear-gradient(135deg, #e2e8f0, #94a3b8);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text
    }

    .hero p {
      font-size: 1rem;
      color: var(--dim);
      max-width: 580px;
      margin: 0 auto
    }

    .page {
      max-width: 880px;
      margin: 0 auto;
      padding: 44px 24px;
      display: flex;
      flex-direction: column;
      gap: 40px
    }

    .sec-label {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px
    }

    .sec-num {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: .8rem;
      font-weight: 700;
      flex-shrink: 0
    }

    .c-green {
      background: rgba(34, 197, 94, .15);
      color: var(--green)
    }

    .c-blue {
      background: rgba(56, 189, 248, .15);
      color: var(--blue)
    }

    .c-yellow {
      background: rgba(251, 191, 36, .15);
      color: var(--yellow)
    }

    .c-purple {
      background: rgba(167, 139, 250, .15);
      color: var(--purple)
    }

    .sec-title {
      font-size: 1.2rem;
      font-weight: 700
    }

    .sec-sub {
      font-size: .84rem;
      color: var(--muted);
      margin-top: 2px
    }

    .box {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      overflow: hidden
    }

    .box-head {
      padding: 13px 18px;
      border-bottom: 1px solid var(--border);
      font-weight: 700;
      font-size: .9rem
    }

    .box-body {
      padding: 16px 18px
    }

    .code {
      font-family: 'Fira Code', monospace;
      font-size: .75rem;
      background: #0d1117;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 14px;
      color: #94a3b8;
      overflow-x: auto;
      line-height: 1.9
    }

    .kw {
      color: #7dd3fc
    }

    .fn {
      color: #86efac
    }

    .str {
      color: #fca5a5
    }

    .cm {
      color: #475569;
      font-style: italic
    }

    .ev {
      color: #fbbf24
    }

    .two-col {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px
    }

    @media(max-width:680px) {
      .two-col {
        grid-template-columns: 1fr
      }
    }

    /* completion banner */
    .completion {
      background: linear-gradient(135deg, rgba(34, 197, 94, .1), rgba(56, 189, 248, .08));
      border: 1px solid rgba(34, 197, 94, .3);
      border-radius: 16px;
      padding: 32px;
      text-align: center
    }

    .comp-icon {
      font-size: 3.5rem;
      margin-bottom: 12px
    }

    .comp-title {
      font-size: 1.4rem;
      font-weight: 800;
      margin-bottom: 8px
    }

    .comp-sub {
      color: var(--dim);
      font-size: .9rem;
      margin-bottom: 20px
    }

    .comp-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin: 16px 0;
      font-size: .75rem
    }

    @media(max-width:600px) {
      .comp-grid {
        grid-template-columns: 1fr 1fr
      }
    }

    .comp-item {
      background: rgba(34, 197, 94, .08);
      border: 1px solid rgba(34, 197, 94, .15);
      border-radius: 8px;
      padding: 8px;
      color: var(--green);
      font-weight: 600
    }

    .golden {
      background: rgba(34, 197, 94, .05);
      border: 1px solid rgba(34, 197, 94, .2);
      border-radius: 14px;
      padding: 20px 22px
    }

    .golden h3 {
      font-size: 1rem;
      color: var(--green);
      margin-bottom: 12px
    }

    .rule-list {
      display: flex;
      flex-direction: column;
      gap: 10px
    }

    .rule-row {
      display: flex;
      gap: 12px;
      align-items: flex-start;
      background: var(--card2);
      border-radius: 10px;
      padding: 12px 14px
    }

    .rule-icon {
      font-size: 1.2rem;
      flex-shrink: 0
    }

    .rule-text {
      font-size: .84rem;
      color: var(--dim);
      line-height: 1.6
    }

    .rule-text strong {
      color: var(--text)
    }

    .nav-bar {
      display: flex;
      gap: 10px;
      justify-content: center;
      padding: 24px;
      border-top: 1px solid var(--border);
      flex-wrap: wrap
    }

    .nav-btn {
      padding: 9px 18px;
      border-radius: 8px;
      border: 1px solid var(--border);
      font-family: 'Inter', sans-serif;
      font-size: .83rem;
      font-weight: 600;
      background: var(--card);
      color: var(--dim);
      text-decoration: none;
      transition: border-color .2s, color .2s
    }

    .nav-btn:hover {
      border-color: var(--green);
      color: var(--text)
    }

    .nav-btn.primary {
      background: var(--green);
      color: #052e16;
      border-color: var(--green)
    }

    .nav-btn.home {
      background: var(--card2)
    }

    code.mono {
      font-family: monospace
    }

    .note-sm {
      font-size: .82rem;
      color: var(--dim);
      margin-top: 10px
    }
  
    /* ‚îÄ‚îÄ MOBILE RESPONSIVE ‚îÄ‚îÄ */
    @media (max-width: 768px) {
      .hero h1 { font-size: 1.6rem !important; }
      .hero p { font-size: .88rem !important; }
      .page { padding: 24px 16px !important; }
      .two-col { grid-template-columns: 1fr !important; }
      .stats { flex-wrap: wrap; gap: 12px; }
      .code, pre { font-size: .7rem !important; }
      .nav-bar, [style*="justify-content:center"][style*="padding:24px"] { 
        flex-direction: column; align-items: center; 
      }
    }
    @media (max-width: 480px) {
      .hero { padding: 40px 16px 32px !important; }
      .hero h1 { font-size: 1.3rem !important; }
      section { margin-bottom: 24px !important; }
    }
</style>
  <script src="config.js"></script>
  <script src="progress.js"></script>
  
</head>

<body>
  <div class="hero">
    <div class="badge">üéì Lesson 28 ‚Äî Final Lesson</div>
    <h1>Deployment üöÄ</h1>
    <p>Take your WebSocket server from <code style="font-family:monospace">localhost</code> to production. Docker,
      nginx, AWS ALB, and environment config ‚Äî the production checklist.</p>
  </div>
  <div class="page">

    <section>
      <div class="sec-label">
        <div class="sec-num c-green">1</div>
        <div>
          <div class="sec-title">Dockerfile for WebSocket Server üê≥</div>
          <div class="sec-sub">Containerize your Node.js WebSocket server</div>
        </div>
      </div>
      <div class="box">
        <div class="box-head" style="color:var(--green)">üìÑ Dockerfile</div>
        <div class="box-body">
          <div class="code">
            <span class="kw">FROM</span> node:<span class="ev">20</span>-alpine<br><br>
            <span class="kw">WORKDIR</span> /app<br>
            <span class="kw">COPY</span> package*.json ./<br>
            <span class="kw">RUN</span> npm ci --production <span class="cm"># only prod deps</span><br>
            <span class="kw">COPY</span> . .<br><br>
            <span class="cm"># Expose non-root port (required on many PaaS)</span><br>
            <span class="kw">EXPOSE</span> <span class="ev">3000</span><br><br>
            <span class="cm"># Graceful shutdown support</span><br>
            <span class="kw">CMD</span> [<span class="str">"node"</span>, <span class="str">"server.js"</span>]
          </div>
          <p class="note-sm">Build: <code class="mono">docker build -t ws-server .</code> | Run: <code
              class="mono">docker run -p 3000:3000 ws-server</code></p>
        </div>
      </div>
    </section>

    <section>
      <div class="sec-label">
        <div class="sec-num c-blue">2</div>
        <div>
          <div class="sec-title">nginx ‚Äî WebSocket reverse proxy üîÑ</div>
          <div class="sec-sub">nginx must be configured to pass Upgrade headers</div>
        </div>
      </div>
      <div class="box">
        <div class="box-head" style="color:var(--blue)">üìÑ /etc/nginx/sites-available/wsapp.conf</div>
        <div class="box-body">
          <div class="code">
            server {<br>
            &nbsp;&nbsp;listen <span class="ev">443</span> ssl;<br>
            &nbsp;&nbsp;server_name api.myapp.com;<br><br>
            &nbsp;&nbsp;<span class="cm"># SSL certs (managed by Certbot / ACM)</span><br>
            &nbsp;&nbsp;ssl_certificate /etc/ssl/cert.pem;<br>
            &nbsp;&nbsp;ssl_certificate_key /etc/ssl/key.pem;<br><br>
            &nbsp;&nbsp;location / {<br>
            &nbsp;&nbsp;&nbsp;&nbsp;proxy_pass http://localhost:3000;<br><br>
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="cm"># WebSocket upgrade headers ‚Äî CRITICAL</span><br>
            &nbsp;&nbsp;&nbsp;&nbsp;proxy_http_version <span class="ev">1.1</span>;<br>
            &nbsp;&nbsp;&nbsp;&nbsp;proxy_set_header Upgrade $http_upgrade;<br>
            &nbsp;&nbsp;&nbsp;&nbsp;proxy_set_header Connection <span class="str">"Upgrade"</span>;<br>
            &nbsp;&nbsp;&nbsp;&nbsp;proxy_set_header Host $host;<br><br>
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="cm"># Extend timeout (default 60s kills idle WS connections)</span><br>
            &nbsp;&nbsp;&nbsp;&nbsp;proxy_read_timeout <span class="ev">3600</span>;<br>
            &nbsp;&nbsp;&nbsp;&nbsp;proxy_send_timeout <span class="ev">3600</span>;<br>
            &nbsp;&nbsp;}<br>
            }
          </div>
          <p class="note-sm" style="color:var(--red)">‚ö†Ô∏è Without the <code class="mono">Upgrade: websocket</code> and
            <code class="mono">Connection: Upgrade</code> headers, nginx strips them and the WebSocket handshake fails
            with 502.</p>
        </div>
      </div>
    </section>

    <section>
      <div class="sec-label">
        <div class="sec-num c-yellow">3</div>
        <div>
          <div class="sec-title">AWS ALB ‚Äî sticky sessions + WS support ‚òÅÔ∏è</div>
          <div class="sec-sub">AWS Application Load Balancer natively supports WebSocket</div>
        </div>
      </div>
      <div class="two-col">
        <div class="box">
          <div class="box-head" style="color:var(--yellow)">‚úÖ ALB supports WebSocket natively</div>
          <div class="box-body">
            <div class="code">
              <span class="cm"># No special config needed!</span><br>
              <span class="cm"># ALB auto-detects WS upgrade and</span><br>
              <span class="cm"># routes all frames to the same target</span><br><span
                class="str">"TargetGroupStickinessConfig"</span>:<br>
              &nbsp;&nbsp;Enabled: <span class="kw">true</span><br>
              &nbsp;&nbsp;DurationSeconds: <span class="ev">86400</span>
            </div>
            <p class="note-sm">Enable sticky sessions so each client always hits the same EC2 instance ‚Äî needed if
              you're not using Redis Pub/Sub (Lesson 11).</p>
          </div>
        </div>
        <div class="box">
          <div class="box-head" style="color:var(--blue)">‚ö†Ô∏è AWS ALB timeout = 60 seconds</div>
          <div class="box-body">
            <div class="code">
              <span class="cm"># ALB closes idle WS after 60s!</span><br>
              <span class="cm"># Fix: set idle timeout to 3600s</span><br>
              aws elbv2 modify-load-balancer-attributes<br>
              &nbsp;&nbsp;--attributes Key=idle_timeout.timeout_seconds,Value=3600<br>
              <span class="cm"># Also see Lesson 9 ‚Äî Heartbeat</span>
            </div>
            <p class="note-sm">Or use the Lesson 9 heartbeat (ping every 55s) to keep connections alive within the 60s
              window.</p>
          </div>
        </div>
      </div>
    </section>

    <section>
      <div class="sec-label">
        <div class="sec-num c-purple">4</div>
        <div>
          <div class="sec-title">Graceful Shutdown üîá</div>
          <div class="sec-sub">Don't drop active connections on deploy/restart</div>
        </div>
      </div>
      <div class="box">
        <div class="box-head" style="color:var(--purple)">&lt;/&gt; server.js ‚Äî graceful shutdown</div>
        <div class="box-body">
          <div class="code">
            process.<span class="fn">on</span>(<span class="str">'SIGTERM'</span>, () =&gt; {<br>
            &nbsp;&nbsp;<span class="fn">console</span>.<span class="fn">log</span>(<span class="str">'SIGTERM received
              ‚Äî shutting down'</span>);<br>
            &nbsp;&nbsp;<span class="cm">// Stop accepting new connections</span><br>
            &nbsp;&nbsp;wss.<span class="fn">close</span>(() =&gt; {<br>
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">// Notify existing clients</span><br>
            &nbsp;&nbsp;&nbsp;&nbsp;wss.clients.<span class="fn">forEach</span>(c =&gt; {<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.<span class="fn">close</span>(<span class="ev">1001</span>, <span
              class="str">'Server restarting'</span>);<br>
            &nbsp;&nbsp;&nbsp;&nbsp;});<br>
            &nbsp;&nbsp;&nbsp;&nbsp;server.<span class="fn">close</span>(() =&gt; process.<span
              class="fn">exit</span>(<span class="ev">0</span>));<br>
            &nbsp;&nbsp;});<br>
            });
          </div>
          <p class="note-sm">Close code 1001 = "Going Away" ‚Äî clients that implement auto-reconnect (Lesson 5) will
            automatically reconnect to the new server instance.</p>
        </div>
      </div>
    </section>

    <!-- COMPLETION BANNER -->
    <section>
      <div class="completion">
        <div class="comp-icon">üèÜ</div>
        <div class="comp-title">You've mastered WebSockets! All 28 Lessons Complete!</div>
        <div class="comp-sub">From the basics of ws.send() to production deployment on AWS ‚Äî you now know everything
          needed to build real-time applications.</div>
        <div class="comp-grid">
          <div class="comp-item">‚úÖ L1‚Äì4: Basics & Events</div>
          <div class="comp-item">‚úÖ L5‚Äì8: Error Handling & Auth</div>
          <div class="comp-item">‚úÖ L9‚Äì12: Heartbeat & Scaling</div>
          <div class="comp-item">‚úÖ L13‚Äì16: Rate Limiting & UX</div>
          <div class="comp-item">‚úÖ L17‚Äì20: History & Frameworks</div>
          <div class="comp-item">‚úÖ L21‚Äì24: Security & Advanced</div>
          <div class="comp-item">‚úÖ L25‚Äì28: Testing & Production</div>
        </div>
      </div>
    </section>

    <section>
      <div class="golden">
        <h3>‚úÖ Deployment Checklist</h3>
        <div class="rule-list">
          <div class="rule-row">
            <div class="rule-icon">üê≥</div>
            <div class="rule-text"><strong>Containerize with Docker</strong> ‚Äî Node 20 alpine is ~50MB. Use multi-stage
              builds for even smaller images.</div>
          </div>
          <div class="rule-row">
            <div class="rule-icon">üîÑ</div>
            <div class="rule-text"><strong>Configure nginx Upgrade headers</strong> ‚Äî <code
                class="mono">proxy_set_header Upgrade $http_upgrade</code> is required. Forget it and WebSocket won't
              work behind nginx.</div>
          </div>
          <div class="rule-row">
            <div class="rule-icon">‚è±Ô∏è</div>
            <div class="rule-text"><strong>Increase proxy timeouts</strong> ‚Äî nginx default is 60s, AWS ALB default is
              60s. Set to at least 3600s or use heartbeats (Lesson 9).</div>
          </div>
          <div class="rule-row">
            <div class="rule-icon">üîá</div>
            <div class="rule-text"><strong>Handle SIGTERM gracefully</strong> ‚Äî Kubernetes and ECS send SIGTERM before
              killing pods. Close connections cleanly so clients auto-reconnect.</div>
          </div>
          <div class="rule-row">
            <div class="rule-icon">üå°Ô∏è</div>
            <div class="rule-text"><strong>Set up health checks</strong> ‚Äî expose <code class="mono">GET /health</code>
              returning 200. Load balancers use it to route traffic. Don't route to unhealthy instances.</div>
          </div>
        </div>
      </div>
    </section>
  </div>

  

  

  
  

  <div style="display:flex;gap:12px;align-items:flex-start;padding:10px 14px;background:rgba(255,255,255,0.02);border-radius:10px;border:1px solid rgba(255,255,255,0.06)">
          <span style="font-size:1.3rem;flex-shrink:0;margin-top:2px">üéÆ</span>
          <div>
            <div style="font-weight:700;font-size:.85rem;color:var(--text);margin-bottom:3px">Fortnite (AWS)</div>
            <div style="font-size:.82rem;color:#94a3b8;line-height:1.6">Epic Games deploys WebSocket game servers on AWS EKS (Kubernetes). Each pod handles ~1000 connections. Auto-scaling spins up new pods during peak hours.</div>
          </div>
        </div>
        <div style="display:flex;gap:12px;align-items:flex-start;padding:10px 14px;background:rgba(255,255,255,0.02);border-radius:10px;border:1px solid rgba(255,255,255,0.06)">
          <span style="font-size:1.3rem;flex-shrink:0;margin-top:2px">üí¨</span>
          <div>
            <div style="font-weight:700;font-size:.85rem;color:var(--text);margin-bottom:3px">Slack</div>
            <div style="font-size:.82rem;color:#94a3b8;line-height:1.6">Slack's WebSocket servers run in Kubernetes with graceful shutdown. When deploying new code, existing connections are drained (code 1001) before the pod terminates.</div>
          </div>
        </div>
        <div style="display:flex;gap:12px;align-items:flex-start;padding:10px 14px;background:rgba(255,255,255,0.02);border-radius:10px;border:1px solid rgba(255,255,255,0.06)">
          <span style="font-size:1.3rem;flex-shrink:0;margin-top:2px">üìä</span>
          <div>
            <div style="font-weight:700;font-size:.85rem;color:var(--text);margin-bottom:3px">Cloudflare Workers</div>
            <div style="font-size:.82rem;color:#94a3b8;line-height:1.6">Cloudflare's Durable Objects run WebSocket servers at the edge (300+ cities). Your users connect to the nearest server for the lowest latency.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

<!-- ‚úÖ MARK COMPLETE -->
  <div style="max-width:880px;margin:0 auto;padding:0 24px 20px">
    <button id="markCompleteBtn" onclick="toggleLessonComplete()" style="width:100%;padding:14px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,.03);color:var(--dim);font-family:Inter,sans-serif;font-size:.9rem;font-weight:700;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:8px">
      <span id="markCompleteIcon">‚òê</span>
      <span id="markCompleteText">Mark Lesson 28 as Complete</span>
    </button>
  </div>
  <script>
    function toggleLessonComplete() {
      const result = WSProgress.toggleComplete(28);
      updateCompleteButton(result.isComplete);
    }
    function updateCompleteButton(isComplete) {
      const btn = document.getElementById('markCompleteBtn');
      const icon = document.getElementById('markCompleteIcon');
      const text = document.getElementById('markCompleteText');
      if (isComplete) {
        btn.style.background = 'rgba(34,197,94,.18)';
        btn.style.borderColor = '#22c55e';
        icon.textContent = '‚úÖ';
        text.textContent = 'Lesson 28 Complete!';
      } else {
        btn.style.background = 'rgba(34,197,94,.08)';
        btn.style.borderColor = '#22c55e';
        icon.textContent = '‚òê';
        text.textContent = 'Mark Lesson 28 as Complete';
      }
    }
    // Check on load
    document.addEventListener('DOMContentLoaded', () => {
      const completed = WSProgress.getCompleted();
      updateCompleteButton(completed.has(28));
    });
  </script>


  </div>

  <!-- üèóÔ∏è SCENARIO IMPLEMENTATIONS (BULK) -->
  <div style="max-width:880px;margin:0 auto;padding:0 24px 28px">
    <div style="font-weight:700;font-size:1.1rem;color:var(--text);margin-bottom:16px">üèóÔ∏è Scenario Implementations</div>
    <div style="display:flex;flex-direction:column;gap:16px">
      <div style="background:transparent;border:1px solid rgba(255,255,255,0.06);border-radius:10px;overflow:hidden">
        <div style="padding:12px 16px;border-bottom:1px solid rgba(255,255,255,0.04);font-weight:600;font-size:.9rem;color:var(--text)">Nginx Reverse Proxy Config</div>
        <pre style="margin:0;padding:16px;background:rgba(0,0,0,0.15);font-family:'Fira Code',monospace;font-size:.78rem;color:#cbd5e1;overflow-x:auto;line-height:1.7;border:none"><code># /etc/nginx/sites-available/default
server {
    listen 80;
    server_name api.myapp.com;

    location /ws/ {
        proxy_pass http://localhost:8080;
        proxy_http_version 1.1;
        
        # Nginx strips headers by default. You MUST forward these
        # two specific headers for the 101 Upgrade to succeed!
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
        
        # Prevent idle connections from dropping immediately
        proxy_read_timeout 86400;
    }
}</code></pre>
      </div>
      <div style="background:transparent;border:1px solid rgba(255,255,255,0.06);border-radius:10px;overflow:hidden">
        <div style="padding:12px 16px;border-bottom:1px solid rgba(255,255,255,0.04);font-weight:600;font-size:.9rem;color:var(--text)">Kubernetes Graceful Shutdown</div>
        <pre style="margin:0;padding:16px;background:rgba(0,0,0,0.15);font-family:'Fira Code',monospace;font-size:.78rem;color:#cbd5e1;overflow-x:auto;line-height:1.7;border:none"><code>// When Kubernetes asks the Pod to terminate gracefully (SIGTERM),
// we must gracefully close WebSockets instead of severing the TCP pipe.

process.on('SIGTERM', () =&gt; {
  console.log('Server shutting down gracefully...');
  
  // Tell all clients we are restarting (Code 1012: Service Restart)
  wss.clients.forEach(ws =&gt; {
    ws.close(1012, "Server rolling update");
  });
  
  // Stop accepting new connections
  server.close(() =&gt; {
    process.exit(0);
  });
});</code></pre>
      </div>
      <div style="background:transparent;border:1px solid rgba(255,255,255,0.06);border-radius:10px;overflow:hidden">
        <div style="padding:12px 16px;border-bottom:1px solid rgba(255,255,255,0.04);font-weight:600;font-size:.9rem;color:var(--text)">Dockerizing a Node WS Server</div>
        <pre style="margin:0;padding:16px;background:rgba(0,0,0,0.15);font-family:'Fira Code',monospace;font-size:.78rem;color:#cbd5e1;overflow-x:auto;line-height:1.7;border:none"><code># Dockerfile
FROM node:18-alpine
WORKDIR /app

# Only copy package files first for strict caching!
COPY package*.json ./
RUN npm ci --only=production

COPY . .

# Expose the specific internal port
EXPOSE 8080
CMD ["node", "server.js"]

# Run with: docker run -p 8080:8080 my-ws-app</code></pre>
      </div>
    </div>
  </div>
<!-- üß† TEST YOURSELF QUIZ -->
  <div style="max-width:880px;margin:0 auto;padding:0 24px 32px">
    <div style="background:transparent;border:1px solid rgba(255,255,255,0.06);border-radius:14px;overflow:hidden">
      <div style="padding:14px 18px;border-bottom:1px solid #1f2d45;font-weight:700;font-size:.95rem;color:var(--text);display:flex;align-items:center;justify-content:space-between">
        <span>üß† Test Yourself</span>
        <span id="quiz_9817_score" style="font-size:.8rem;color:#94a3b8">0/3 answered</span>
      </div>
      <div style="padding:18px">
        <div id="quiz_9817_q0" style="margin-bottom:20px">
          <div style="font-size:.88rem;font-weight:600;color:var(--text);margin-bottom:10px">1. Why does nginx need special config for WebSocket?</div>
          <div style="display:flex;flex-direction:column;gap:6px">
            <button id="quiz_9817_q0_o0" onclick="quiz_9817_check(0,0)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">A. Nginx doesn't support HTTP</button>
            <button id="quiz_9817_q0_o1" onclick="quiz_9817_check(0,1)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">B. WebSocket uses HTTP Upgrade headers that nginx must forward</button>
            <button id="quiz_9817_q0_o2" onclick="quiz_9817_check(0,2)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">C. Nginx is too fast</button>
            <button id="quiz_9817_q0_o3" onclick="quiz_9817_check(0,3)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">D. WebSocket requires UDP</button>
          </div>
          <div id="quiz_9817_q0_explain" style="display:none;margin-top:8px;padding:10px 14px;border-radius:8px;font-size:.82rem;line-height:1.6"></div>
        </div>
        <div id="quiz_9817_q1" style="margin-bottom:20px">
          <div style="font-size:.88rem;font-weight:600;color:var(--text);margin-bottom:10px">2. What is graceful shutdown?</div>
          <div style="display:flex;flex-direction:column;gap:6px">
            <button id="quiz_9817_q1_o0" onclick="quiz_9817_check(1,0)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">A. Turning off the computer</button>
            <button id="quiz_9817_q1_o1" onclick="quiz_9817_check(1,1)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">B. Closing all connections cleanly before the server stops</button>
            <button id="quiz_9817_q1_o2" onclick="quiz_9817_check(1,2)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">C. Deleting all data</button>
            <button id="quiz_9817_q1_o3" onclick="quiz_9817_check(1,3)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">D. Reloading the page</button>
          </div>
          <div id="quiz_9817_q1_explain" style="display:none;margin-top:8px;padding:10px 14px;border-radius:8px;font-size:.82rem;line-height:1.6"></div>
        </div>
        <div id="quiz_9817_q2" style="margin-bottom:20px">
          <div style="font-size:.88rem;font-weight:600;color:var(--text);margin-bottom:10px">3. What close code indicates the server is going away?</div>
          <div style="display:flex;flex-direction:column;gap:6px">
            <button id="quiz_9817_q2_o0" onclick="quiz_9817_check(2,0)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">A. 1000</button>
            <button id="quiz_9817_q2_o1" onclick="quiz_9817_check(2,1)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">B. 1001</button>
            <button id="quiz_9817_q2_o2" onclick="quiz_9817_check(2,2)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">C. 4001</button>
            <button id="quiz_9817_q2_o3" onclick="quiz_9817_check(2,3)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">D. 1006</button>
          </div>
          <div id="quiz_9817_q2_explain" style="display:none;margin-top:8px;padding:10px 14px;border-radius:8px;font-size:.82rem;line-height:1.6"></div>
        </div>
      </div>
    </div>
  </div>
  <script>
    (function() {
      const answers = [1, 1, 1];
      const explains = ['WebSocket starts as HTTP, then upgrades. Nginx must pass the Upgrade and Connection headers for this to work.', 'Graceful shutdown sends close frames to all connected clients (code 1001) before the process exits.', "Code 1001 = 'Going Away'. Used when the server is shutting down or the client is navigating away."];
      let answered = new Set();
      let correct = 0;
      window.quiz_9817_check = function(qi, oi) {
        if (answered.has(qi)) return;
        answered.add(qi);
        const isCorrect = oi === answers[qi];
        if (isCorrect) correct++;
        // Style the selected option
        const btn = document.getElementById("quiz_9817_q" + qi + "_o" + oi);
        btn.style.background = isCorrect ? "rgba(34,197,94,.15)" : "rgba(248,113,113,.15)";
        btn.style.borderColor = isCorrect ? "#22c55e" : "#f87171";
        btn.style.color = isCorrect ? "#22c55e" : "#f87171";
        btn.textContent = (isCorrect ? "‚úÖ " : "‚ùå ") + btn.textContent;
        // If wrong, highlight correct answer
        if (!isCorrect) {
          const correctBtn = document.getElementById("quiz_9817_q" + qi + "_o" + answers[qi]);
          correctBtn.style.background = "rgba(34,197,94,.15)";
          correctBtn.style.borderColor = "#22c55e";
          correctBtn.style.color = "#22c55e";
        }
        // Disable all options for this question
        for(let j=0; j<4; j++) {
          const b = document.getElementById("quiz_9817_q" + qi + "_o" + j);
          if(b) b.style.pointerEvents = "none";
        }
        // Show explanation
        const exp = document.getElementById("quiz_9817_q" + qi + "_explain");
        exp.style.display = "block";
        exp.style.background = isCorrect ? "rgba(34,197,94,.08)" : "rgba(248,113,113,.08)";
        exp.style.borderLeft = "3px solid " + (isCorrect ? "#22c55e" : "#f87171");
        exp.style.color = "#cbd5e1";
        exp.innerHTML = (isCorrect ? "‚úÖ Correct! " : "‚ùå Not quite. ") + explains[qi];
        // Update score
        const scoreEl = document.getElementById("quiz_9817_score");
        scoreEl.textContent = correct + "/3 correct";
        if (answered.size === 3) {
          scoreEl.style.color = correct === 3 ? "#22c55e" : correct >= 2 ? "#fbbf24" : "#f87171";
          scoreEl.style.fontWeight = "700";
        }
      };
    })();
  </script>

<!-- ‚ïê‚ïê‚ïê BEGINNER REFERENCE SECTIONS ‚ïê‚ïê‚ïê -->
  <div style="max-width:880px;margin:0 auto;padding:0 24px 32px">
    <!-- üìã Quick Cheat Sheet -->
    <div style="background:transparent;border:1px solid rgba(255,255,255,0.06);border-radius:14px;overflow:hidden;margin-bottom:24px">
      <div style="padding:14px 18px;border-bottom:1px solid #1f2d45;font-weight:700;font-size:.95rem;color:var(--text)">üìã Quick Cheat Sheet ‚Äî Deployment</div>
      <div style="overflow-x:auto">
        <table style="width:100%;border-collapse:collapse;font-size:.83rem">
          <thead><tr><th style="padding:10px 14px;background:rgba(255,255,255,0.02);color:#94a3b8;font-weight:600;font-size:.75rem;text-transform:uppercase;letter-spacing:.4px;border-bottom:1px solid #1f2d45;text-align:left">Code</th><th style="padding:10px 14px;background:rgba(255,255,255,0.02);color:#94a3b8;font-weight:600;font-size:.75rem;text-transform:uppercase;letter-spacing:.4px;border-bottom:1px solid #1f2d45;text-align:left">What it does</th><th style="padding:10px 14px;background:rgba(255,255,255,0.02);color:#94a3b8;font-weight:600;font-size:.75rem;text-transform:uppercase;letter-spacing:.4px;border-bottom:1px solid #1f2d45;text-align:left">When</th></tr></thead>
          <tbody>
            <tr><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:#7dd3fc;font-family:'Fira Code',monospace;font-size:.78rem"><code>Dockerfile</code></td><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:var(--text)">Containerize your WS server</td><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:#94a3b8;font-size:.78rem">Consistent environments</td></tr>
            <tr><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:#7dd3fc;font-family:'Fira Code',monospace;font-size:.78rem"><code>nginx proxy_pass</code></td><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:var(--text)">Reverse proxy for WebSocket</td><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:#94a3b8;font-size:.78rem">Need Upgrade header support</td></tr>
            <tr><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:#7dd3fc;font-family:'Fira Code',monospace;font-size:.78rem"><code>proxy_set_header Upgrade $http_upgrade</code></td><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:var(--text)">Enable WS through nginx</td><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:#94a3b8;font-size:.78rem">Critical nginx config</td></tr>
            <tr><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:#7dd3fc;font-family:'Fira Code',monospace;font-size:.78rem"><code>graceful shutdown</code></td><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:var(--text)">Close all connections before exit</td><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:#94a3b8;font-size:.78rem">process.on('SIGTERM')</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- üí° Key Takeaways -->
    <div style="background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,0.06);border-radius:14px;padding:18px 20px;margin-bottom:24px">
      <div style="font-weight:700;font-size:.95rem;color:var(--text);margin-bottom:12px">üí° Key Takeaways for Beginners</div>
      <div style="display:flex;gap:10px;align-items:flex-start;margin-bottom:10px;font-size:.86rem;color:#cbd5e1;line-height:1.65"><span style="color:var(--text);flex-shrink:0">‚ñ∏</span><span>Use <strong>Docker</strong> to containerize your server ‚Äî it runs the same everywhere (dev, staging, prod).</span></div>
      <div style="display:flex;gap:10px;align-items:flex-start;margin-bottom:10px;font-size:.86rem;color:#cbd5e1;line-height:1.65"><span style="color:var(--text);flex-shrink:0">‚ñ∏</span><span>Nginx needs special config for WebSocket ‚Äî you must pass <code>Upgrade</code> and <code>Connection</code> headers.</span></div>
      <div style="display:flex;gap:10px;align-items:flex-start;margin-bottom:10px;font-size:.86rem;color:#cbd5e1;line-height:1.65"><span style="color:var(--text);flex-shrink:0">‚ñ∏</span><span><strong>Graceful shutdown</strong>: When the server stops, close all WebSocket connections cleanly (code 1001) before exiting.</span></div>
      <div style="display:flex;gap:10px;align-items:flex-start;margin-bottom:10px;font-size:.86rem;color:#cbd5e1;line-height:1.65"><span style="color:var(--text);flex-shrink:0">‚ñ∏</span><span>Use health checks (<code>/health</code> endpoint) so load balancers know when your server is ready.</span></div>
      <div style="display:flex;gap:10px;align-items:flex-start;margin-bottom:10px;font-size:.86rem;color:#cbd5e1;line-height:1.65"><span style="color:var(--text);flex-shrink:0">‚ñ∏</span><span>In production: Docker container ‚Üí behind nginx ‚Üí load balanced ‚Üí auto-scaled ‚Üí monitored. That's the full stack.</span></div>
    </div>

  </div>

<div class="nav-bar">
    <a href="index.html" class="nav-btn home">üè† Home</a>
    <a href="learn27.html" class="nav-btn">‚Üê Lesson 27</a>
    <a href="WEBSOCKET_STUDY_NOTES.md" class="nav-btn">üìö Notes</a>
    <a href="index.html" class="nav-btn primary">üè† Back to Hub</a>
  </div>
</body>

</html>