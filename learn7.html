<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lesson 7 ‚Äî Rooms &amp; Channels</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Fira+Code:wght@400;500&display=swap"
    rel="stylesheet" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg: #0a0d16;
      --card: #111827;
      --card2: #1a2235;
      --card3: #0d1525;
      --border: #1f2d45;
      --text: #e2e8f0;
      --muted: #64748b;
      --dim: #94a3b8;
      --green: #22c55e;
      --blue: #38bdf8;
      --purple: #a78bfa;
      --yellow: #fbbf24;
      --red: #f87171;
      --orange: #fb923c;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
    }

    .hero {
      text-align: center;
      padding: 56px 24px 40px;
      background: radial-gradient(ellipse 80% 60% at 50% 0%, rgba(167, 139, 250, .07), transparent);
      border-bottom: 1px solid var(--border);
    }

    .hero-tag {
      display: inline-block;
      background: rgba(167, 139, 250, .1);
      color: var(--purple);
      border: 1px solid rgba(167, 139, 250, .25);
      border-radius: 99px;
      padding: 4px 14px;
      font-size: .75rem;
      font-weight: 600;
      letter-spacing: 1px;
      text-transform: uppercase;
      margin-bottom: 18px;
    }

    .hero h1 {
      font-size: clamp(1.8rem, 5vw, 3rem);
      font-weight: 800;
      margin-bottom: 12px;
      background: linear-gradient(135deg, #e2e8f0, #94a3b8);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero p {
      font-size: 1rem;
      color: var(--dim);
      max-width: 580px;
      margin: 0 auto;
    }

    .page {
      max-width: 880px;
      margin: 0 auto;
      padding: 44px 24px;
      display: flex;
      flex-direction: column;
      gap: 48px;
    }

    .sec-label {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
    }

    .sec-num {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: .8rem;
      font-weight: 700;
      flex-shrink: 0;
    }

    .sec-num.c-purple {
      background: rgba(167, 139, 250, .15);
      color: var(--purple);
    }

    .sec-num.c-green {
      background: rgba(34, 197, 94, .15);
      color: var(--green);
    }

    .sec-num.c-yellow {
      background: rgba(251, 191, 36, .15);
      color: var(--yellow);
    }

    .sec-num.c-blue {
      background: rgba(56, 189, 248, .15);
      color: var(--blue);
    }

    .sec-title {
      font-size: 1.2rem;
      font-weight: 700;
    }

    .sec-sub {
      font-size: .84rem;
      color: var(--muted);
      margin-top: 2px;
    }

    .box {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      overflow: hidden;
    }

    .box-head {
      padding: 13px 18px;
      border-bottom: 1px solid var(--border);
      font-weight: 700;
      font-size: .9rem;
    }

    .box-head.c-purple {
      color: var(--purple);
    }

    .box-head.c-green {
      color: var(--green);
    }

    .box-head.c-yellow {
      color: var(--yellow);
    }

    .box-head.c-blue {
      color: var(--blue);
    }

    .box-body {
      padding: 16px 18px;
    }

    .box-body p {
      font-size: .87rem;
      color: var(--dim);
      line-height: 1.7;
    }

    .two-col {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    @media(max-width:680px) {
      .two-col {
        grid-template-columns: 1fr;
      }
    }

    .code {
      font-family: 'Fira Code', monospace;
      font-size: .77rem;
      background: #0d1117;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 14px;
      color: #94a3b8;
      overflow-x: auto;
      line-height: 1.9;
    }

    .kw {
      color: #7dd3fc;
    }

    .fn {
      color: #86efac;
    }

    .str {
      color: #fca5a5;
    }

    .cm {
      color: #475569;
      font-style: italic;
    }

    .ev {
      color: #fbbf24;
    }

    .room-demo {
      background: var(--card);
      border: 1px solid rgba(167, 139, 250, .2);
      border-radius: 16px;
      overflow: hidden;
    }

    .room-header {
      padding: 12px 18px;
      background: var(--card2);
      border-bottom: 1px solid var(--border);
      font-weight: 700;
      font-size: .9rem;
    }

    .rooms-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
    }

    .room-panel {
      padding: 14px;
      border-right: 1px solid var(--border);
    }

    .room-panel:last-child {
      border-right: none;
    }

    .room-name {
      font-size: .82rem;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .room-badge {
      font-size: .68rem;
      padding: 2px 8px;
      border-radius: 99px;
      font-weight: 600;
    }

    .rb-general {
      background: rgba(56, 189, 248, .15);
      color: var(--blue);
    }

    .rb-sports {
      background: rgba(34, 197, 94, .15);
      color: var(--green);
    }

    .room-msgs {
      height: 100px;
      overflow-y: auto;
      font-family: 'Fira Code', monospace;
      font-size: .7rem;
      color: var(--dim);
    }

    .room-msg.mine {
      color: var(--purple);
    }

    .room-msg.theirs {
      color: var(--blue);
    }

    .room-msg.sys {
      color: var(--muted);
      font-style: italic;
    }

    .room-controls {
      padding: 10px 14px;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 8px;
    }

    .room-input {
      flex: 1;
      background: var(--card3);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 7px 10px;
      font-size: .8rem;
      color: var(--text);
      outline: none;
      font-family: 'Inter', sans-serif;
    }

    .room-input:disabled {
      opacity: .4;
    }

    .demo-controls {
      padding: 14px 18px;
      background: var(--card2);
      border-top: 1px solid var(--border);
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }

    .btn {
      padding: 8px 16px;
      border-radius: 8px;
      border: none;
      font-family: 'Inter', sans-serif;
      font-size: .82rem;
      font-weight: 600;
      cursor: pointer;
      transition: opacity .2s;
    }

    .btn:hover:not(:disabled) {
      opacity: .85;
    }

    .btn:disabled {
      opacity: .3;
      cursor: not-allowed;
    }

    .btn-purple {
      background: var(--purple);
      color: #1a0a2e;
    }

    .btn-blue {
      background: var(--blue);
      color: #082f49;
    }

    .btn-green {
      background: var(--green);
      color: #052e16;
    }

    .btn-ghost {
      background: var(--card);
      color: var(--dim);
      border: 1px solid var(--border);
    }

    .btn-sm {
      padding: 6px 11px;
      font-size: .78rem;
    }

    .golden {
      background: rgba(167, 139, 250, .05);
      border: 1px solid rgba(167, 139, 250, .2);
      border-radius: 14px;
      padding: 20px 22px;
    }

    .golden h3 {
      font-size: 1rem;
      color: var(--purple);
      margin-bottom: 12px;
    }

    .rule-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .rule-row {
      display: flex;
      gap: 12px;
      align-items: flex-start;
      background: var(--card2);
      border-radius: 10px;
      padding: 12px 14px;
    }

    .rule-icon {
      font-size: 1.2rem;
      flex-shrink: 0;
    }

    .rule-text {
      font-size: .84rem;
      color: var(--dim);
      line-height: 1.6;
    }

    .rule-text strong {
      color: var(--text);
    }

    .nav-bar {
      display: flex;
      gap: 10px;
      justify-content: center;
      padding: 24px;
      border-top: 1px solid var(--border);
      flex-wrap: wrap;
    }

    .nav-btn {
      padding: 9px 18px;
      border-radius: 8px;
      border: 1px solid var(--border);
      font-family: 'Inter', sans-serif;
      font-size: .83rem;
      font-weight: 600;
      background: var(--card);
      color: var(--dim);
      cursor: pointer;
      text-decoration: none;
      transition: border-color .2s, color .2s;
    }

    .nav-btn:hover {
      border-color: var(--purple);
      color: var(--text);
    }

    .nav-btn.primary {
      background: var(--purple);
      color: #1a0a2e;
      border-color: var(--purple);
    }

    .nav-btn.home {
      background: var(--card2);
    }

    code.mono {
      font-family: monospace;
    }

    .note-sm {
      font-size: .82rem;
      color: var(--dim);
      margin-top: 10px;
    }
  
    /* ‚îÄ‚îÄ MOBILE RESPONSIVE ‚îÄ‚îÄ */
    @media (max-width: 768px) {
      .hero h1 { font-size: 1.6rem !important; }
      .hero p { font-size: .88rem !important; }
      .page { padding: 24px 16px !important; }
      .two-col { grid-template-columns: 1fr !important; }
      .stats { flex-wrap: wrap; gap: 12px; }
      .code, pre { font-size: .7rem !important; }
      .nav-bar, [style*="justify-content:center"][style*="padding:24px"] { 
        flex-direction: column; align-items: center; 
      }
    }
    @media (max-width: 480px) {
      .hero { padding: 40px 16px 32px !important; }
      .hero h1 { font-size: 1.3rem !important; }
      section { margin-bottom: 24px !important; }
    }
</style>
  <script src="config.js"></script>
  <script src="progress.js"></script>
  <script src="theme.js"></script>
</head>

<body>
  <div class="hero">
    <div class="hero-tag">üéì Lesson 7</div>
    <h1>Rooms &amp; Channels üè†</h1>
    <p>Route messages only to clients in the same "room." The foundation of Slack channels, Discord servers, and every
      real chat app.</p>
  </div>
  <div class="page">
    <section>
      <div class="sec-label">
        <div class="sec-num c-purple">1</div>
        <div>
          <div class="sec-title">Rooms are just a Map of Sets üó∫Ô∏è</div>
          <div class="sec-sub">No magic ‚Äî plain JavaScript data structures on the server</div>
        </div>
      </div>
      <div class="two-col">
        <div class="box">
          <div class="box-head c-yellow">üì¶ What a room actually is</div>
          <div class="box-body">
            <p style="margin-bottom:10px">A room is a <strong style="color:var(--text)">key in a Map</strong> pointing
              to a <strong style="color:var(--text)">Set of sockets</strong>:</p>
            <div class="code">
              Map {<br>
              &nbsp;&nbsp;<span class="str">"general"</span> ‚Üí Set { wsA, wsB, wsC },<br>
              &nbsp;&nbsp;<span class="str">"sports"</span> ‚Üí Set { wsB, wsD },<br>
              &nbsp;&nbsp;<span class="str">"music"</span> ‚Üí Set { wsA, wsE }<br>
              }
            </div>
            <p class="note-sm">wsB is in both ‚Äî one client can join multiple rooms!</p>
          </div>
        </div>
        <div class="box">
          <div class="box-head c-purple">üîÄ Rooms vs Global Broadcast</div>
          <div class="box-body">
            <div class="code">
              <span class="cm">// A sends to #general</span><br>
              <span class="ev">‚úÖ</span> Client B (in #general) receives<br>
              <span class="ev">‚úÖ</span> Client C (in #general) receives<br>
              <span class="cm">‚ùå</span> Client D (in #sports only) misses
            </div>
            <p class="note-sm">Like posting in Slack ‚Äî only that channel's members see it.</p>
          </div>
        </div>
      </div>
    </section>

    <section>
      <div class="sec-label">
        <div class="sec-num c-green">2</div>
        <div>
          <div class="sec-title">Server Code ‚Äî Rooms Pattern üíª</div>
          <div class="sec-sub">Full implementation using Map + Set</div>
        </div>
      </div>
      <div class="box">
        <div class="box-head c-green">&lt;/&gt; server.js ‚Äî rooms</div>
        <div class="box-body">
          <div class="code">
            <span class="kw">const</span> rooms = <span class="kw">new</span> <span class="fn">Map</span>();<br><br>
            <span class="kw">function</span> <span class="fn">joinRoom</span>(ws, name) {<br>
            &nbsp;&nbsp;<span class="kw">if</span> (!rooms.<span class="fn">has</span>(name)) rooms.<span
              class="fn">set</span>(name, <span class="kw">new</span> <span class="fn">Set</span>());<br>
            &nbsp;&nbsp;rooms.<span class="fn">get</span>(name).<span class="fn">add</span>(ws);<br>
            &nbsp;&nbsp;ws.room = name;<br>
            }<br><br>
            <span class="kw">function</span> <span class="fn">broadcastRoom</span>(name, msg, exclude) {<br>
            &nbsp;&nbsp;rooms.<span class="fn">get</span>(name)?.<span class="fn">forEach</span>(client => {<br>
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="kw">if</span> (client !== exclude && client.readyState ===
            WebSocket.<span class="ev">OPEN</span>)<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client.<span class="fn">send</span>(<span
              class="fn">JSON.stringify</span>(msg));<br>
            &nbsp;&nbsp;});<br>
            }<br><br>
            ws.<span class="fn">on</span>(<span class="str">'message'</span>, raw => {<br>
            &nbsp;&nbsp;<span class="kw">const</span> { type, room, text } = <span
              class="fn">JSON.parse</span>(raw);<br>
            &nbsp;&nbsp;<span class="kw">if</span> (type === <span class="str">'join'</span>) <span
              class="fn">joinRoom</span>(ws, room);<br>
            &nbsp;&nbsp;<span class="kw">if</span> (type === <span class="str">'message'</span>) <span
              class="fn">broadcastRoom</span>(room, { room, text }, ws);<br>
            });<br><br>
            ws.<span class="fn">on</span>(<span class="str">'close'</span>, () => rooms.<span
              class="fn">forEach</span>(r => r.<span class="fn">delete</span>(ws))); <span class="cm">// cleanup!</span>
          </div>
        </div>
      </div>
    </section>

    <section>
      <div class="sec-label">
        <div class="sec-num c-purple">3</div>
        <div>
          <div class="sec-title">‚ñ∂Ô∏è Live Room Demo</div>
          <div class="sec-sub">Two rooms side by side ‚Äî messages stay in their own room</div>
        </div>
      </div>
      <div class="room-demo">
        <div class="room-header">üè† Room Demo ‚Äî #general and #sports</div>
        <div class="rooms-grid">
          <div class="room-panel">
            <div class="room-name"><span class="room-badge rb-general">#general</span> <span
                style="font-size:.7rem;color:var(--muted)" id="gCount">0 members</span></div>
            <div class="room-msgs" id="gMsgs">
              <div class="room-msg sys">Join to see messages‚Ä¶</div>
            </div>
            <div class="room-controls">
              <input class="room-input" id="gInput" placeholder="Message #general‚Ä¶" disabled />
              <button class="btn btn-blue btn-sm" id="gSend" onclick="sendRoom('general')" disabled>Send</button>
            </div>
          </div>
          <div class="room-panel">
            <div class="room-name"><span class="room-badge rb-sports">#sports</span> <span
                style="font-size:.7rem;color:var(--muted)" id="sCount">0 members</span></div>
            <div class="room-msgs" id="sMsgs">
              <div class="room-msg sys">Join to see messages‚Ä¶</div>
            </div>
            <div class="room-controls">
              <input class="room-input" id="sInput" placeholder="Message #sports‚Ä¶" disabled />
              <button class="btn btn-green btn-sm" id="sSend" onclick="sendRoom('sports')" disabled>Send</button>
            </div>
          </div>
        </div>
        <div class="demo-controls">
          <button class="btn btn-blue" onclick="join('general')">Join #general</button>
          <button class="btn btn-green" onclick="join('sports')">Join #sports</button>
          <button class="btn btn-ghost" onclick="leaveAll()">Leave All</button>
          <span style="font-size:.78rem;color:var(--muted);margin-left:auto" id="roomStatus">Not in any room</span>
        </div>
      </div>
    </section>

    <section>
      <div class="sec-label">
        <div class="sec-num c-yellow">4</div>
        <div>
          <div class="sec-title">‚ö° Room Rules</div>
          <div class="sec-sub">Important for any real rooms implementation</div>
        </div>
      </div>
      <div class="golden">
        <h3>‚úÖ Rooms Checklist</h3>
        <div class="rule-list">
          <div class="rule-row">
            <div class="rule-icon">üßπ</div>
            <div class="rule-text"><strong>Clean up on disconnect</strong> ‚Äî always remove the socket from all rooms in
              the close handler, or you'll accumulate dead sockets.</div>
          </div>
          <div class="rule-row">
            <div class="rule-icon">üîë</div>
            <div class="rule-text"><strong>Validate room names server-side</strong> ‚Äî never let a client join rooms
              they're not allowed in.</div>
          </div>
          <div class="rule-row">
            <div class="rule-icon">üë•</div>
            <div class="rule-text"><strong>One client can join many rooms</strong> ‚Äî store <code
                class="mono">ws.rooms = new Set()</code> to track multiple memberships.</div>
          </div>
          <div class="rule-row">
            <div class="rule-icon">üìä</div>
            <div class="rule-text"><strong>Broadcast member count changes</strong> ‚Äî tell clients when someone
              joins/leaves so UIs stay accurate.</div>
          </div>
        </div>
      </div>
    </section>
  </div>

  

  

  
  

  <div style="display:flex;gap:12px;align-items:flex-start;padding:10px 14px;background:var(--card2);border-radius:10px;border:1px solid var(--border)">
          <span style="font-size:1.3rem;flex-shrink:0;margin-top:2px">üè¢</span>
          <div>
            <div style="font-weight:700;font-size:.85rem;color:var(--text);margin-bottom:3px">Microsoft Teams</div>
            <div style="font-size:.82rem;color:#94a3b8;line-height:1.6">Team channels, private chats, and meeting rooms are all WebSocket rooms. A user can monitor dozens of rooms simultaneously.</div>
          </div>
        </div>
        <div style="display:flex;gap:12px;align-items:flex-start;padding:10px 14px;background:var(--card2);border-radius:10px;border:1px solid var(--border)">
          <span style="font-size:1.3rem;flex-shrink:0;margin-top:2px">üéÆ</span>
          <div>
            <div style="font-weight:700;font-size:.85rem;color:var(--text);margin-bottom:3px">Game Lobbies (Fortnite)</div>
            <div style="font-size:.82rem;color:#94a3b8;line-height:1.6">Each match lobby is a room. When the game starts, players are moved from the lobby room to a game room. The lobby room is then cleaned up.</div>
          </div>
        </div>
        <div style="display:flex;gap:12px;align-items:flex-start;padding:10px 14px;background:var(--card2);border-radius:10px;border:1px solid var(--border)">
          <span style="font-size:1.3rem;flex-shrink:0;margin-top:2px">üìπ</span>
          <div>
            <div style="font-weight:700;font-size:.85rem;color:var(--text);margin-bottom:3px">Zoom Breakout Rooms</div>
            <div style="font-size:.82rem;color:#94a3b8;line-height:1.6">The main meeting is one room. Breakout sessions create sub-rooms. The host can broadcast to all rooms or just one.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

<!-- ‚úÖ MARK COMPLETE -->
  <div style="max-width:880px;margin:0 auto;padding:0 24px 20px">
    <button id="markCompleteBtn" onclick="toggleLessonComplete()" style="width:100%;padding:14px;border-radius:10px;border:1px solid var(--border);background:rgba(255,255,255,.03);color:var(--dim);font-family:Inter,sans-serif;font-size:.9rem;font-weight:700;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:8px">
      <span id="markCompleteIcon">‚òê</span>
      <span id="markCompleteText">Mark Lesson 7 as Complete</span>
    </button>
  </div>
  <script>
    function toggleLessonComplete() {
      const result = WSProgress.toggleComplete(7);
      updateCompleteButton(result.isComplete);
    }
    function updateCompleteButton(isComplete) {
      const btn = document.getElementById('markCompleteBtn');
      const icon = document.getElementById('markCompleteIcon');
      const text = document.getElementById('markCompleteText');
      if (isComplete) {
        btn.style.background = 'rgba(34,197,94,.18)';
        btn.style.borderColor = '#22c55e';
        icon.textContent = '‚úÖ';
        text.textContent = 'Lesson 7 Complete!';
      } else {
        btn.style.background = 'rgba(34,197,94,.08)';
        btn.style.borderColor = '#22c55e';
        icon.textContent = '‚òê';
        text.textContent = 'Mark Lesson 7 as Complete';
      }
    }
    // Check on load
    document.addEventListener('DOMContentLoaded', () => {
      const completed = WSProgress.getCompleted();
      updateCompleteButton(completed.has(7));
    });
  </script>


  <!-- üèóÔ∏è SCENARIO DESIGN & IMPLEMENTATION -->
  <div style="max-width:880px;margin:0 auto;padding:0 24px 28px">
    <div style="background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden">
      <div style="padding:16px 20px;border-bottom:1px solid var(--border);font-weight:700;font-size:.95rem;color:var(--text);display:flex;align-items:center;gap:8px">
        <span>üèóÔ∏è Scenario Implementation:</span>
        <span style="color:var(--dim);font-weight:500">Multiplayer Game Lobbies (Rooms)</span>
      </div>
      <div style="padding:20px">
        <div style="margin-bottom:18px">
          <div style="font-size:.75rem;text-transform:uppercase;letter-spacing:1px;font-weight:700;color:var(--dim);margin-bottom:6px">The Design Approach</div>
          <div style="font-size:.88rem;color:var(--text);line-height:1.7">In a game like Fortnite, player movements in Match A shouldn't be broadcast to players in Match B. We implement 'Rooms' using a <code>Map</code> where the key is the match ID, and the value is a <code>Set</code> of WebSocket connections belonging to that match. We only broadcast to that specific Set.</div>
        </div>
        <div>
          <div style="font-size:.75rem;text-transform:uppercase;letter-spacing:1px;font-weight:700;color:var(--dim);margin-bottom:6px">Implementation Code</div>
        <pre style="margin:0;padding:16px;background:var(--card3);border:1px solid var(--border);border-radius:8px;font-family:'Fira Code',monospace;font-size:.78rem;color:#94a3b8;overflow-x:auto;line-height:1.8"><code>// Data Structure: Map&lt;roomId, Set&lt;WebSocket&gt;&gt;
const rooms = new Map();

function joinRoom(ws, roomId) {
  if (!rooms.has(roomId)) rooms.set(roomId, new Set());
  rooms.get(roomId).add(ws);
}

function broadcastToRoom(roomId, message) {
  const roomClients = rooms.get(roomId);
  if (!roomClients) return;
  
  const payload = JSON.stringify(message);
  for (const client of roomClients) {
    if (client.readyState === WebSocket.OPEN) {
      client.send(payload);
    }
  }
}</code></pre>
        </div>
      </div>
    </div>
  </div>
<!-- üß† TEST YOURSELF QUIZ -->
  <div style="max-width:880px;margin:0 auto;padding:0 24px 32px">
    <div style="background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden">
      <div style="padding:14px 18px;border-bottom:1px solid #1f2d45;font-weight:700;font-size:.95rem;color:var(--text);display:flex;align-items:center;justify-content:space-between">
        <span>üß† Test Yourself</span>
        <span id="quiz_9817_score" style="font-size:.8rem;color:#94a3b8">0/3 answered</span>
      </div>
      <div style="padding:18px">
        <div id="quiz_9817_q0" style="margin-bottom:20px">
          <div style="font-size:.88rem;font-weight:600;color:var(--text);margin-bottom:10px">1. What data structure is best for managing rooms?</div>
          <div style="display:flex;flex-direction:column;gap:6px">
            <button id="quiz_9817_q0_o0" onclick="quiz_9817_check(0,0)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid var(--border);background:var(--card2);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">A. Array</button>
            <button id="quiz_9817_q0_o1" onclick="quiz_9817_check(0,1)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid var(--border);background:var(--card2);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">B. Object</button>
            <button id="quiz_9817_q0_o2" onclick="quiz_9817_check(0,2)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid var(--border);background:var(--card2);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">C. Map<string, Set<WebSocket>></button>
            <button id="quiz_9817_q0_o3" onclick="quiz_9817_check(0,3)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid var(--border);background:var(--card2);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">D. String</button>
          </div>
          <div id="quiz_9817_q0_explain" style="display:none;margin-top:8px;padding:10px 14px;border-radius:8px;font-size:.82rem;line-height:1.6"></div>
        </div>
        <div id="quiz_9817_q1" style="margin-bottom:20px">
          <div style="font-size:.88rem;font-weight:600;color:var(--text);margin-bottom:10px">2. What should happen when a client disconnects?</div>
          <div style="display:flex;flex-direction:column;gap:6px">
            <button id="quiz_9817_q1_o0" onclick="quiz_9817_check(1,0)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid var(--border);background:var(--card2);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">A. Nothing</button>
            <button id="quiz_9817_q1_o1" onclick="quiz_9817_check(1,1)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid var(--border);background:var(--card2);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">B. Remove them from all rooms they were in</button>
            <button id="quiz_9817_q1_o2" onclick="quiz_9817_check(1,2)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid var(--border);background:var(--card2);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">C. Delete all rooms</button>
            <button id="quiz_9817_q1_o3" onclick="quiz_9817_check(1,3)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid var(--border);background:var(--card2);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">D. Reconnect them automatically</button>
          </div>
          <div id="quiz_9817_q1_explain" style="display:none;margin-top:8px;padding:10px 14px;border-radius:8px;font-size:.82rem;line-height:1.6"></div>
        </div>
        <div id="quiz_9817_q2" style="margin-bottom:20px">
          <div style="font-size:.88rem;font-weight:600;color:var(--text);margin-bottom:10px">3. Can a client be in multiple rooms at once?</div>
          <div style="display:flex;flex-direction:column;gap:6px">
            <button id="quiz_9817_q2_o0" onclick="quiz_9817_check(2,0)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid var(--border);background:var(--card2);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">A. No, only one room</button>
            <button id="quiz_9817_q2_o1" onclick="quiz_9817_check(2,1)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid var(--border);background:var(--card2);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">B. Yes, as many as needed</button>
            <button id="quiz_9817_q2_o2" onclick="quiz_9817_check(2,2)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid var(--border);background:var(--card2);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">C. Only 2 rooms</button>
            <button id="quiz_9817_q2_o3" onclick="quiz_9817_check(2,3)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid var(--border);background:var(--card2);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">D. Only with Socket.io</button>
          </div>
          <div id="quiz_9817_q2_explain" style="display:none;margin-top:8px;padding:10px 14px;border-radius:8px;font-size:.82rem;line-height:1.6"></div>
        </div>
      </div>
    </div>
  </div>
  <script>
    (function() {
      const answers = [2, 1, 1];
      const explains = ['A Map with room names as keys and Sets of WebSocket connections as values is the standard pattern.', 'Always remove disconnected clients from all rooms to avoid sending messages to dead connections.', 'A client can be in multiple rooms ‚Äî just add their WebSocket to multiple room Sets.'];
      let answered = new Set();
      let correct = 0;
      window.quiz_9817_check = function(qi, oi) {
        if (answered.has(qi)) return;
        answered.add(qi);
        const isCorrect = oi === answers[qi];
        if (isCorrect) correct++;
        // Style the selected option
        const btn = document.getElementById("quiz_9817_q" + qi + "_o" + oi);
        btn.style.background = isCorrect ? "rgba(34,197,94,.15)" : "rgba(248,113,113,.15)";
        btn.style.borderColor = isCorrect ? "#22c55e" : "#f87171";
        btn.style.color = isCorrect ? "#22c55e" : "#f87171";
        btn.textContent = (isCorrect ? "‚úÖ " : "‚ùå ") + btn.textContent;
        // If wrong, highlight correct answer
        if (!isCorrect) {
          const correctBtn = document.getElementById("quiz_9817_q" + qi + "_o" + answers[qi]);
          correctBtn.style.background = "rgba(34,197,94,.15)";
          correctBtn.style.borderColor = "#22c55e";
          correctBtn.style.color = "#22c55e";
        }
        // Disable all options for this question
        for(let j=0; j<4; j++) {
          const b = document.getElementById("quiz_9817_q" + qi + "_o" + j);
          if(b) b.style.pointerEvents = "none";
        }
        // Show explanation
        const exp = document.getElementById("quiz_9817_q" + qi + "_explain");
        exp.style.display = "block";
        exp.style.background = isCorrect ? "rgba(34,197,94,.08)" : "rgba(248,113,113,.08)";
        exp.style.borderLeft = "3px solid " + (isCorrect ? "#22c55e" : "#f87171");
        exp.style.color = "#cbd5e1";
        exp.innerHTML = (isCorrect ? "‚úÖ Correct! " : "‚ùå Not quite. ") + explains[qi];
        // Update score
        const scoreEl = document.getElementById("quiz_9817_score");
        scoreEl.textContent = correct + "/3 correct";
        if (answered.size === 3) {
          scoreEl.style.color = correct === 3 ? "#22c55e" : correct >= 2 ? "#fbbf24" : "#f87171";
          scoreEl.style.fontWeight = "700";
        }
      };
    })();
  </script>

<!-- ‚ïê‚ïê‚ïê BEGINNER REFERENCE SECTIONS ‚ïê‚ïê‚ïê -->
  <div style="max-width:880px;margin:0 auto;padding:0 24px 32px">
    <!-- üìã Quick Cheat Sheet -->
    <div style="background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden;margin-bottom:24px">
      <div style="padding:14px 18px;border-bottom:1px solid #1f2d45;font-weight:700;font-size:.95rem;color:var(--text)">üìã Quick Cheat Sheet ‚Äî Rooms & Channels</div>
      <div style="overflow-x:auto">
        <table style="width:100%;border-collapse:collapse;font-size:.83rem">
          <thead><tr><th style="padding:10px 14px;background:var(--card2);color:#94a3b8;font-weight:600;font-size:.75rem;text-transform:uppercase;letter-spacing:.4px;border-bottom:1px solid #1f2d45;text-align:left">Code</th><th style="padding:10px 14px;background:var(--card2);color:#94a3b8;font-weight:600;font-size:.75rem;text-transform:uppercase;letter-spacing:.4px;border-bottom:1px solid #1f2d45;text-align:left">What it does</th><th style="padding:10px 14px;background:var(--card2);color:#94a3b8;font-weight:600;font-size:.75rem;text-transform:uppercase;letter-spacing:.4px;border-bottom:1px solid #1f2d45;text-align:left">When</th></tr></thead>
          <tbody>
            <tr><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:#7dd3fc;font-family:'Fira Code',monospace;font-size:.78rem"><code>Map&lt;string, Set&lt;WebSocket&gt;&gt;</code></td><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:var(--text)">Data structure for rooms</td><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:#94a3b8;font-size:.78rem">roomName ‚Üí set of clients</td></tr>
            <tr><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:#7dd3fc;font-family:'Fira Code',monospace;font-size:.78rem"><code>rooms.get(name).add(ws)</code></td><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:var(--text)">Add a client to a room</td><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:#94a3b8;font-size:.78rem">On join request</td></tr>
            <tr><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:#7dd3fc;font-family:'Fira Code',monospace;font-size:.78rem"><code>rooms.get(name).delete(ws)</code></td><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:var(--text)">Remove a client from a room</td><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:#94a3b8;font-size:.78rem">On leave or disconnect</td></tr>
            <tr><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:#7dd3fc;font-family:'Fira Code',monospace;font-size:.78rem"><code>rooms.get(name).forEach(client =&gt; ...)</code></td><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:var(--text)">Broadcast to room only</td><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:#94a3b8;font-size:.78rem">Send to room members</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- üí° Key Takeaways -->
    <div style="background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:14px;padding:18px 20px;margin-bottom:24px">
      <div style="font-weight:700;font-size:.95rem;color:var(--text);margin-bottom:12px">üí° Key Takeaways for Beginners</div>
      <div style="display:flex;gap:10px;align-items:flex-start;margin-bottom:10px;font-size:.86rem;color:#cbd5e1;line-height:1.65"><span style="color:var(--text);flex-shrink:0">‚ñ∏</span><span>Rooms let you broadcast to a <strong>subset</strong> of users instead of everyone. Like separate group chats.</span></div>
      <div style="display:flex;gap:10px;align-items:flex-start;margin-bottom:10px;font-size:.86rem;color:#cbd5e1;line-height:1.65"><span style="color:var(--text);flex-shrink:0">‚ñ∏</span><span>A room is just a <code>Map</code> of room names ‚Üí <code>Set</code> of WebSocket connections. No magic library needed.</span></div>
      <div style="display:flex;gap:10px;align-items:flex-start;margin-bottom:10px;font-size:.86rem;color:#cbd5e1;line-height:1.65"><span style="color:var(--text);flex-shrink:0">‚ñ∏</span><span>When a client <strong>disconnects</strong>, remove them from ALL rooms they were in ‚Äî otherwise you get ghost members.</span></div>
      <div style="display:flex;gap:10px;align-items:flex-start;margin-bottom:10px;font-size:.86rem;color:#cbd5e1;line-height:1.65"><span style="color:var(--text);flex-shrink:0">‚ñ∏</span><span>A single client can be in <strong>multiple rooms</strong> at once (like being in #general and #random on Slack).</span></div>
      <div style="display:flex;gap:10px;align-items:flex-start;margin-bottom:10px;font-size:.86rem;color:#cbd5e1;line-height:1.65"><span style="color:var(--text);flex-shrink:0">‚ñ∏</span><span>This pattern is the foundation of chat apps, game lobbies, and notification channels.</span></div>
    </div>

    <!-- üíª Production Pattern -->
    <div style="background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden;margin-bottom:24px">
      <div style="padding:14px 18px;border-bottom:1px solid #1f2d45;font-weight:700;font-size:.95rem;color:var(--text)">üíª Room management on the server</div>
      <pre style="margin:0;padding:16px 18px;font-family:'Fira Code',monospace;font-size:.78rem;color:#94a3b8;overflow-x:auto;line-height:1.8;background:var(--card3)"><code>const rooms = new Map(); // { 'room-name': Set<WebSocket> }

function joinRoom(ws, roomName) {
  // Create the room if it doesn't exist
  if (!rooms.has(roomName)) {
    rooms.set(roomName, new Set());
  }
  rooms.get(roomName).add(ws);   // Add this client to the room
  console.log(`Client joined #${roomName}`);
}

function leaveRoom(ws, roomName) {
  const room = rooms.get(roomName);
  if (room) {
    room.delete(ws);             // Remove this client
    if (room.size === 0) {
      rooms.delete(roomName);    // Clean up empty rooms
    }
  }
}

function broadcastToRoom(roomName, message, sender) {
  const room = rooms.get(roomName);
  if (!room) return;

  room.forEach((client) => {
    // Send to everyone in the room EXCEPT the sender
    if (client !== sender && client.readyState === 1) {
      client.send(JSON.stringify(message));
    }
  });
}</code></pre>
    </div>
  </div>

<div class="nav-bar">
    <a href="index.html" class="nav-btn home">üè† Home</a>
    <a href="learn6.html" class="nav-btn">‚Üê Lesson 6</a>
    <a href="WEBSOCKET_STUDY_NOTES.md" class="nav-btn">üìö Notes</a>
    <a href="learn8.html" class="nav-btn primary">Lesson 8: Auth ‚Üí</a>
  </div>

  <script>
    const myRooms = new Set(), memberCounts = { general: 2, sports: 3 };
    function addMsg(id, text, cls) {
      const el = document.getElementById(id);
      const d = document.createElement('div');
      d.className = `room-msg ${cls}`; d.textContent = text;
      el.appendChild(d); el.scrollTop = el.scrollHeight;
    }
    function updateUI() {
      document.getElementById('gCount').textContent = (myRooms.has('general') ? memberCounts.general : 0) + ' member(s)';
      document.getElementById('sCount').textContent = (myRooms.has('sports') ? memberCounts.sports : 0) + ' member(s)';
      document.getElementById('roomStatus').textContent = myRooms.size ? 'In: ' + [...myRooms].join(', ') : 'Not in any room';
    }
    function join(room) {
      if (myRooms.has(room)) return;
      myRooms.add(room);
      const pre = room === 'general' ? 'g' : 's';
      addMsg(pre + 'Msgs', `‚úÖ You joined #${room}`, 'sys');
      if (room === 'general') addMsg('gMsgs', 'üëã [Bot] Welcome to #general!', 'theirs');
      if (room === 'sports') addMsg('sMsgs', '‚öΩ [Bot] Latest: City 2‚Äì1 United', 'theirs');
      document.getElementById(pre + 'Input').disabled = false;
      document.getElementById(pre + 'Send').disabled = false;
      updateUI();
    }
    function sendRoom(room) {
      const pre = room === 'general' ? 'g' : 's';
      const input = document.getElementById(pre + 'Input');
      const text = input.value.trim(); if (!text) return;
      addMsg(pre + 'Msgs', `üì§ You: ${text}`, 'mine');
      setTimeout(() => addMsg(pre + 'Msgs', `üì® [Other]: "${text}" received!`, 'theirs'), 600);
      input.value = ''; input.focus();
    }
    function leaveAll() {
      myRooms.forEach(room => {
        const pre = room === 'general' ? 'g' : 's';
        addMsg(pre + 'Msgs', `üëã You left #${room}`, 'sys');
        document.getElementById(pre + 'Input').disabled = true;
        document.getElementById(pre + 'Send').disabled = true;
      });
      myRooms.clear(); updateUI();
    }
    ['general', 'sports'].forEach(room => {
      const pre = room === 'general' ? 'g' : 's';
      document.addEventListener('DOMContentLoaded', () =>
        document.getElementById(pre + 'Input').addEventListener('keydown', e => { if (e.key === 'Enter') sendRoom(room); }));
    });
  </script>
</body>

</html>