<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Lesson 19 ‚Äî WebSocket with React</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Fira+Code:wght@400;500&display=swap"
    rel="stylesheet" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box
    }

        :root {
      --bg: #ffffff;
      --card: #f8fafc;
      --card2: #f1f5f9;
      --border: #e2e8f0;
      --text: #0f172a;
      --muted: #64748b;
      --dim: #475569;
      --green: #16a34a;
      --blue: #0284c7;
      --purple: #7c3aed;
      --yellow: #ca8a04;
      --red: #dc2626;
      --orange: #ea580c;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6
    }

    .hero {
      text-align: center;
      padding: 56px 24px 40px;
      background: radial-gradient(ellipse 80% 60% at 50% 0%, rgba(6, 182, 212, .07), transparent);
      border-bottom: 1px solid var(--border)
    }

    .badge {
      display: inline-block;
      background: rgba(6, 182, 212, .1);
      color: var(--cyan);
      border: 1px solid rgba(6, 182, 212, .25);
      border-radius: 99px;
      padding: 4px 14px;
      font-size: .75rem;
      font-weight: 600;
      letter-spacing: 1px;
      text-transform: uppercase;
      margin-bottom: 18px
    }

    h1 {
      font-size: clamp(1.8rem, 5vw, 3rem);
      font-weight: 800;
      margin-bottom: 12px;
      background: linear-gradient(135deg, #e2e8f0, #94a3b8);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text
    }

    .hero p {
      font-size: 1rem;
      color: var(--dim);
      max-width: 580px;
      margin: 0 auto
    }

    .page {
      max-width: 880px;
      margin: 0 auto;
      padding: 44px 24px;
      display: flex;
      flex-direction: column;
      gap: 40px
    }

    .sec-label {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px
    }

    .sec-num {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: .8rem;
      font-weight: 700;
      flex-shrink: 0
    }

    .c-cyan {
      background: rgba(6, 182, 212, .15);
      color: var(--cyan)
    }

    .c-green {
      background: rgba(34, 197, 94, .15);
      color: var(--green)
    }

    .c-yellow {
      background: rgba(251, 191, 36, .15);
      color: var(--yellow)
    }

    .sec-title {
      font-size: 1.2rem;
      font-weight: 700
    }

    .sec-sub {
      font-size: .84rem;
      color: var(--muted);
      margin-top: 2px
    }

    .box {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      overflow: hidden
    }

    .box-head {
      padding: 13px 18px;
      border-bottom: 1px solid var(--border);
      font-weight: 700;
      font-size: .9rem
    }

    .box-body {
      padding: 16px 18px
    }

    .code {
      font-family: 'Fira Code', monospace;
      font-size: .75rem;
      background: #f8fafc;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 14px;
      color: #334155;
      overflow-x: auto;
      line-height: 1.9
    }

    .kw {
      color: #0284c7
    }

    .fn {
      color: #16a34a
    }

    .str {
      color: #dc2626
    }

    .cm {
      color: #475569;
      font-style: italic
    }

    .ev {
      color: #fbbf24
    }

    .golden {
      background: rgba(6, 182, 212, .05);
      border: 1px solid rgba(6, 182, 212, .2);
      border-radius: 14px;
      padding: 20px 22px
    }

    .golden h3 {
      font-size: 1rem;
      color: var(--cyan);
      margin-bottom: 12px
    }

    .rule-list {
      display: flex;
      flex-direction: column;
      gap: 10px
    }

    .rule-row {
      display: flex;
      gap: 12px;
      align-items: flex-start;
      background: var(--card2);
      border-radius: 10px;
      padding: 12px 14px
    }

    .rule-icon {
      font-size: 1.2rem;
      flex-shrink: 0
    }

    .rule-text {
      font-size: .84rem;
      color: var(--dim);
      line-height: 1.6
    }

    .rule-text strong {
      color: var(--text)
    }

    .nav-bar {
      display: flex;
      gap: 10px;
      justify-content: center;
      padding: 24px;
      border-top: 1px solid var(--border);
      flex-wrap: wrap
    }

    .nav-btn {
      padding: 9px 18px;
      border-radius: 8px;
      border: 1px solid var(--border);
      font-family: 'Inter', sans-serif;
      font-size: .83rem;
      font-weight: 600;
      background: var(--card);
      color: var(--dim);
      text-decoration: none;
      transition: border-color .2s, color .2s
    }

    .nav-btn:hover {
      border-color: var(--cyan);
      color: var(--text)
    }

    .nav-btn.primary {
      background: var(--cyan);
      color: #042f2e;
      border-color: var(--cyan)
    }

    .nav-btn.home {
      background: var(--card2)
    }

    code.mono {
      font-family: monospace
    }

    .note-sm {
      font-size: .82rem;
      color: var(--dim);
      margin-top: 10px
    }

    .hl {
      border-radius: 8px;
      padding: 12px 14px;
      border-left: 3px solid;
      font-size: .84rem;
      line-height: 1.7;
      margin-top: 12px
    }

    .hl.cyan {
      border-color: var(--cyan);
      background: rgba(6, 182, 212, .05);
      color: var(--dim)
    }

    .hl.red {
      border-color: var(--red);
      background: rgba(248, 113, 113, .05);
      color: var(--dim)
    }

    .two-col {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px
    }

    @media(max-width:680px) {
      .two-col {
        grid-template-columns: 1fr
      }
    }
  
    /* ‚îÄ‚îÄ MOBILE RESPONSIVE ‚îÄ‚îÄ */
    @media (max-width: 768px) {
      .hero h1 { font-size: 1.6rem !important; }
      .hero p { font-size: .88rem !important; }
      .page { padding: 24px 16px !important; }
      .two-col { grid-template-columns: 1fr !important; }
      .stats { flex-wrap: wrap; gap: 12px; }
      .code, pre { font-size: .7rem !important; }
      .nav-bar, [style*="justify-content:center"][style*="padding:24px"] { 
        flex-direction: column; align-items: center; 
      }
    }
    @media (max-width: 480px) {
      .hero { padding: 40px 16px 32px !important; }
      .hero h1 { font-size: 1.3rem !important; }
      section { margin-bottom: 24px !important; }
    }
</style>
  <script src="config.js"></script>
  <script src="progress.js"></script>
  
</head>

<body>
  <div class="hero">
    <div class="badge">üéì Lesson 19</div>
    <h1>WebSocket with React ‚öõÔ∏è</h1>
    <p>The hardest part isn't the WebSocket ‚Äî it's managing it correctly inside React's lifecycle. Learn the <code
        style="font-family:monospace">useWebSocket</code> custom hook pattern used in production apps.</p>
  </div>
  <div class="page">

    <section>
      <div class="sec-label">
        <div class="sec-num c-cyan">1</div>
        <div>
          <div class="sec-title">The common mistakes in React + WS ‚ùå</div>
          <div class="sec-sub">Creating WS in the wrong place creates memory leaks</div>
        </div>
      </div>
      <div class="two-col">
        <div class="box">
          <div class="box-head" style="color:var(--red)">‚ùå Wrong ‚Äî creates new WS on every render</div>
          <div class="box-body">
            <div class="code">
              <span class="kw">function</span> <span class="fn">ChatComponent</span>() {<br>
              &nbsp;&nbsp;<span class="cm">// üíÄ Runs on EVERY render!</span><br>
              &nbsp;&nbsp;<span class="kw">const</span> ws = <span class="kw">new</span> <span
                class="fn">WebSocket</span>(<span class="str">'ws://...'</span>);<br>
              &nbsp;&nbsp;<span class="cm">// Old connections are never closed!</span><br>
              }
            </div>
            <p class="note-sm" style="color:var(--red)">Every state change = new WebSocket = memory leak.</p>
          </div>
        </div>
        <div class="box">
          <div class="box-head" style="color:var(--red)">‚ùå Also wrong ‚Äî no cleanup</div>
          <div class="box-body">
            <div class="code">
              <span class="fn">useEffect</span>(() =&gt; {<br>
              &nbsp;&nbsp;<span class="kw">const</span> ws = <span class="kw">new</span> <span
                class="fn">WebSocket</span>(<span class="str">'ws://...'</span>);<br>
              &nbsp;&nbsp;<span class="cm">// üíÄ No return cleanup!</span><br>
              &nbsp;&nbsp;<span class="cm">// Component unmount ‚Üí ws never closed</span><br>
              }, []);
            </div>
            <p class="note-sm" style="color:var(--red)">Navigating away leaves ghost connections open.</p>
          </div>
        </div>
      </div>
    </section>

    <section>
      <div class="sec-label">
        <div class="sec-num c-green">2</div>
        <div>
          <div class="sec-title">useWebSocket ‚Äî the correct custom hook ‚úÖ</div>
          <div class="sec-sub">Create once, cleanup on unmount, reconnect on close</div>
        </div>
      </div>
      <div class="box">
        <div class="box-head" style="color:var(--green)">&lt;/&gt; hooks/useWebSocket.js</div>
        <div class="box-body">
          <div class="code">
            <span class="kw">import</span> { useEffect, useRef, useState, useCallback } <span class="kw">from</span>
            <span class="str">'react'</span>;<br><br>
            <span class="kw">export function</span> <span class="fn">useWebSocket</span>(url) {<br>
            &nbsp;&nbsp;<span class="kw">const</span> wsRef = <span class="fn">useRef</span>(<span
              class="kw">null</span>);<br>
            &nbsp;&nbsp;<span class="kw">const</span> [status, setStatus] = <span class="fn">useState</span>(<span
              class="str">'connecting'</span>);<br>
            &nbsp;&nbsp;<span class="kw">const</span> [lastMessage, setLastMessage] = <span
              class="fn">useState</span>(<span class="kw">null</span>);<br><br>
            &nbsp;&nbsp;<span class="fn">useEffect</span>(() =&gt; {<br>
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="kw">let</span> active = <span class="kw">true</span>; <span
              class="cm">// prevents state update after unmount</span><br>
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="kw">const</span> ws = <span class="kw">new</span> <span
              class="fn">WebSocket</span>(url);<br>
            &nbsp;&nbsp;&nbsp;&nbsp;wsRef.current = ws;<br><br>
            &nbsp;&nbsp;&nbsp;&nbsp;ws.<span class="fn">addEventListener</span>(<span class="str">'open'</span>, ()
            =&gt; active &amp;&amp; <span class="fn">setStatus</span>(<span class="str">'open'</span>));<br>
            &nbsp;&nbsp;&nbsp;&nbsp;ws.<span class="fn">addEventListener</span>(<span class="str">'close'</span>, ()
            =&gt; active &amp;&amp; <span class="fn">setStatus</span>(<span class="str">'closed'</span>));<br>
            &nbsp;&nbsp;&nbsp;&nbsp;ws.<span class="fn">addEventListener</span>(<span class="str">'message'</span>, (e)
            =&gt; {<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kw">if</span> (active) <span
              class="fn">setLastMessage</span>(<span class="fn">JSON.parse</span>(e.data));<br>
            &nbsp;&nbsp;&nbsp;&nbsp;});<br><br>
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="cm">// ‚úÖ Cleanup on unmount ‚Äî always close!</span><br>
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="kw">return</span> () =&gt; { active = <span class="kw">false</span>;
            ws.<span class="fn">close</span>(); };<br>
            &nbsp;&nbsp;}, [url]);<br><br>
            &nbsp;&nbsp;<span class="kw">const</span> send = <span class="fn">useCallback</span>((data) =&gt; {<br>
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="kw">if</span> (wsRef.current?.readyState === WebSocket.<span
              class="ev">OPEN</span>)<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wsRef.current.<span class="fn">send</span>(<span
              class="fn">JSON.stringify</span>(data));<br>
            &nbsp;&nbsp;}, []);<br><br>
            &nbsp;&nbsp;<span class="kw">return</span> { status, lastMessage, send };<br>
            }
          </div>
        </div>
      </div>
    </section>

    <section>
      <div class="sec-label">
        <div class="sec-num c-yellow">3</div>
        <div>
          <div class="sec-title">Using the hook in a component üíª</div>
          <div class="sec-sub">Clean, readable React code</div>
        </div>
      </div>
      <div class="box">
        <div class="box-head" style="color:var(--yellow)">&lt;/&gt; ChatRoom.jsx</div>
        <div class="box-body">
          <div class="code">
            <span class="kw">function</span> <span class="fn">ChatRoom</span>() {<br>
            &nbsp;&nbsp;<span class="kw">const</span> { status, lastMessage, send } = <span
              class="fn">useWebSocket</span>(<span class="str">getWsUrl(8082)</span>);<br>
            &nbsp;&nbsp;<span class="kw">const</span> [messages, setMessages] = <span
              class="fn">useState</span>([]);<br><br>
            &nbsp;&nbsp;<span class="cm">// React to new messages</span><br>
            &nbsp;&nbsp;<span class="fn">useEffect</span>(() =&gt; {<br>
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="kw">if</span> (lastMessage) <span class="fn">setMessages</span>(prev
            =&gt; [...prev, lastMessage]);<br>
            &nbsp;&nbsp;}, [lastMessage]);<br><br>
            &nbsp;&nbsp;<span class="kw">return</span> (<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&lt;<span class="fn">div</span>&gt;<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<span class="fn">p</span>&gt;Status: {status}&lt;/<span
              class="fn">p</span>&gt;<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{messages.<span class="fn">map</span>(m =&gt; &lt;<span
              class="fn">p</span> key={m.id}&gt;{m.text}&lt;/<span class="fn">p</span>&gt;)}<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<span class="fn">button</span> onClick={() =&gt; <span
              class="fn">send</span>({ text: <span class="str">'Hello!'</span> })}&gt;Send&lt;/<span
              class="fn">button</span>&gt;<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&lt;/<span class="fn">div</span>&gt;<br>
            &nbsp;&nbsp;);<br>
            }
          </div>
          <div class="hl cyan">
            <strong style="color:var(--cyan)">Key pattern:</strong> The hook returns <code
              class="mono">lastMessage</code> as state. A <code class="mono">useEffect</code> watches it and appends to
            the messages array. This keeps the WebSocket logic completely separate from the UI logic.
          </div>
        </div>
      </div>
    </section>

    <section>
      <div class="golden">
        <h3>‚úÖ React + WebSocket Rules</h3>
        <div class="rule-list">
          <div class="rule-row">
            <div class="rule-icon">ü™ù</div>
            <div class="rule-text"><strong>Always use a custom hook</strong> ‚Äî never create WebSocket inside the
              component body or without useEffect.</div>
          </div>
          <div class="rule-row">
            <div class="rule-icon">üßπ</div>
            <div class="rule-text"><strong>Always return a cleanup function</strong> from useEffect that calls <code
                class="mono">ws.close()</code>. Without this, navigating away leaks the connection.</div>
          </div>
          <div class="rule-row">
            <div class="rule-icon">üèÉ</div>
            <div class="rule-text"><strong>Use an <code class="mono">active</code> flag</strong> ‚Äî set to false in
              cleanup to prevent <code class="mono">setState</code> calls after unmount, which cause React warnings.
            </div>
          </div>
          <div class="rule-row">
            <div class="rule-icon">üì¶</div>
            <div class="rule-text"><strong>Use react-use-websocket</strong> for production ‚Äî it's a battle-tested
              library that handles reconnect, filtering, and memoization.</div>
          </div>
        </div>
      </div>
    </section>
  </div>

  

  

  
  

  <div style="display:flex;gap:12px;align-items:flex-start;padding:10px 14px;background:rgba(255,255,255,0.02);border-radius:10px;border:1px solid rgba(255,255,255,0.06)">
          <span style="font-size:1.3rem;flex-shrink:0;margin-top:2px">üí¨</span>
          <div>
            <div style="font-weight:700;font-size:.85rem;color:var(--text);margin-bottom:3px">Discord (Web App)</div>
            <div style="font-size:.82rem;color:#94a3b8;line-height:1.6">Discord's web client is built with React. Each channel component has its own <code>useEffect</code> that subscribes to WebSocket events for that channel.</div>
          </div>
        </div>
        <div style="display:flex;gap:12px;align-items:flex-start;padding:10px 14px;background:rgba(255,255,255,0.02);border-radius:10px;border:1px solid rgba(255,255,255,0.06)">
          <span style="font-size:1.3rem;flex-shrink:0;margin-top:2px">üéµ</span>
          <div>
            <div style="font-weight:700;font-size:.85rem;color:var(--text);margin-bottom:3px">Spotify Web Player</div>
            <div style="font-size:.82rem;color:#94a3b8;line-height:1.6">React components for "Now Playing" and "Friend Activity" each subscribe to WebSocket events using hooks, updating independently.</div>
          </div>
        </div>
        <div style="display:flex;gap:12px;align-items:flex-start;padding:10px 14px;background:rgba(255,255,255,0.02);border-radius:10px;border:1px solid rgba(255,255,255,0.06)">
          <span style="font-size:1.3rem;flex-shrink:0;margin-top:2px">üìà</span>
          <div>
            <div style="font-weight:700;font-size:.85rem;color:var(--text);margin-bottom:3px">TradingView</div>
            <div style="font-size:.82rem;color:#94a3b8;line-height:1.6">Their charting library uses React + WebSocket. Price updates flow through a custom <code>useWebSocket</code> hook into chart components.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

<!-- ‚úÖ MARK COMPLETE -->
  <div style="max-width:880px;margin:0 auto;padding:0 24px 20px">
    <button id="markCompleteBtn" onclick="toggleLessonComplete()" style="width:100%;padding:14px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,.03);color:var(--dim);font-family:Inter,sans-serif;font-size:.9rem;font-weight:700;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:8px">
      <span id="markCompleteIcon">‚òê</span>
      <span id="markCompleteText">Mark Lesson 19 as Complete</span>
    </button>
  </div>
  <script>
    function toggleLessonComplete() {
      const result = WSProgress.toggleComplete(19);
      updateCompleteButton(result.isComplete);
    }
    function updateCompleteButton(isComplete) {
      const btn = document.getElementById('markCompleteBtn');
      const icon = document.getElementById('markCompleteIcon');
      const text = document.getElementById('markCompleteText');
      if (isComplete) {
        btn.style.background = 'rgba(34,197,94,.18)';
        btn.style.borderColor = '#22c55e';
        icon.textContent = '‚úÖ';
        text.textContent = 'Lesson 19 Complete!';
      } else {
        btn.style.background = 'rgba(34,197,94,.08)';
        btn.style.borderColor = '#22c55e';
        icon.textContent = '‚òê';
        text.textContent = 'Mark Lesson 19 as Complete';
      }
    }
    // Check on load
    document.addEventListener('DOMContentLoaded', () => {
      const completed = WSProgress.getCompleted();
      updateCompleteButton(completed.has(19));
    });
  </script>


  </div>

  
  <!-- üèóÔ∏è STORY-DRIVEN SCENARIO IMPLEMENTATION -->
  <div style="max-width:880px;margin:0 auto;padding:0 24px 28px">
    <div style="background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);">
      <div style="padding:16px 20px;border-bottom:1px solid var(--border);font-weight:700;font-size:1.05rem;color:var(--text);display:flex;align-items:center;gap:8px; background:var(--card2)">
        <span>üèóÔ∏è</span>
        <span>Scenario 1: React Component Unmount Memory Leaks</span>
      </div>
      <div style="padding:20px">
        <div style="margin-bottom:22px">
          <div style="font-size:.75rem;text-transform:uppercase;letter-spacing:1px;font-weight:800;color:var(--blue);margin-bottom:8px">üìñ The Logic & Flow</div>
          <div style="font-size:.9rem;color:var(--dim);line-height:1.75">**The Business Problem:** In React, a developer puts `const ws = new WebSocket(...)` directly inside a `<ChatRoom>` component. The user navigates between the 'Home' and 'Chat' pages 10 times. Because React completely destroys and rebuilds the component each time, the browser ends up opening 10 physical WebSocket connections simultaneously. Background network traffic explodes, battery drains, and the server crashes from ghost connections.<br><br>**The End-to-End Flow:** WebSockets must be cleanly managed inside a `useEffect` hook. The initialization of the socket happens when the component Mounts. Most importantly, the `useEffect` must return a 'Cleanup Function'. When React destroys the component (Unmounts), React executes this cleanup function, which forcefully executes `ws.close()`. This ensures absolute 1:1 parity between what is on the screen and what is on the network adapter.</div>
        </div>
        <div>
          <div style="font-size:.75rem;text-transform:uppercase;letter-spacing:1px;font-weight:800;color:var(--blue);margin-bottom:8px">üíª Implementation Code</div>
          <pre style="margin:0;padding:16px;background:#f8fafc;border:1px solid var(--border);border-radius:8px;font-family:'Fira Code',monospace;font-size:.8rem;color:#334155;overflow-x:auto;line-height:1.8"><code>import React, { useEffect, useState } from 'react';

function LiveTicker({ symbol }) {
  const [price, setPrice] = useState(0);

  useEffect(() =&gt; {
    // 1. Component Mounts: Open the hardware connection
    const ws = new WebSocket(`wss://api.stocks.com/ticker/${symbol}`);
    
    ws.onmessage = (e) =&gt; {
      setPrice(JSON.parse(e.data).currentPrice);
    };

    // 2. Component Unmounts (or 'symbol' changes): Clean up!
    return () =&gt; {
      console.log(`Cleaning up old connection to ${symbol}`);
      
      // Forcefully kill the hardware connection to free RAM/Ports
      if (ws.readyState !== WebSocket.CLOSED) {
        ws.close(); 
      }
    };
  }, [symbol]); // Re-run if they search for a new stock

  return &lt;div&gt;{symbol}: ${price}&lt;/div&gt;;
}</code></pre>
        </div>
      </div>
    </div>
  </div>

  <!-- üèóÔ∏è STORY-DRIVEN SCENARIO IMPLEMENTATION -->
  <div style="max-width:880px;margin:0 auto;padding:0 24px 28px">
    <div style="background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);">
      <div style="padding:16px 20px;border-bottom:1px solid var(--border);font-weight:700;font-size:1.05rem;color:var(--text);display:flex;align-items:center;gap:8px; background:var(--card2)">
        <span>üèóÔ∏è</span>
        <span>Scenario 2: The Global 'useWebSocket' Custom Hook</span>
      </div>
      <div style="padding:20px">
        <div style="margin-bottom:22px">
          <div style="font-size:.75rem;text-transform:uppercase;letter-spacing:1px;font-weight:800;color:var(--blue);margin-bottom:8px">üìñ The Logic & Flow</div>
          <div style="font-size:.9rem;color:var(--dim);line-height:1.75">**The Business Problem:** Three different UI components deeply nested in the React tree (Navbar, Chatbox, Profile) all need access to send data down the same WebSocket pipeline. Passing the `ws` object down through 10 layers of React props (Prop Drilling) makes the codebase an unmaintainable nightmare.<br><br>**The End-to-End Flow:** The architect abstracts the pure network logic into a Custom React Hook (`useWebSocket`) wrapped inside a React Context Provider. The App wraps this Provider at the very highest level (above the Router). The Provider automatically handles the single global connection and reconnection logic. Any nested component simply imports `useWebSocket()`, which grants them instant access to the `sendMessage()` function and the unified `lastMessage` state object, completely bypassing prop-drilling.</div>
        </div>
        <div>
          <div style="font-size:.75rem;text-transform:uppercase;letter-spacing:1px;font-weight:800;color:var(--blue);margin-bottom:8px">üíª Implementation Code</div>
          <pre style="margin:0;padding:16px;background:#f8fafc;border:1px solid var(--border);border-radius:8px;font-family:'Fira Code',monospace;font-size:.8rem;color:#334155;overflow-x:auto;line-height:1.8"><code>import { createContext, useContext, useEffect, useRef } from 'react';

// 1. Create a global 'Cloud' bucket holding the network pipe
const WsContext = createContext(null);

export function WebSocketProvider({ children }) {
  const wsRef = useRef(null); // Keep reference across renders

  useEffect(() =&gt; {
    // Initialize exactly ONCE at the app root level
    wsRef.current = new WebSocket('wss://api.global.com');
    return () =&gt; wsRef.current.close();
  }, []);

  // Expose a clean, safe wrapper function, NOT the raw socket
  const triggerEvent = (eventName, data) =&gt; {
    if (wsRef.current?.readyState === WebSocket.OPEN) {
      wsRef.current.send(JSON.stringify({ eventName, data }));
    }
  };

  return (
    &lt;WsContext.Provider value={{ triggerEvent }}&gt;
      {children}
    &lt;/WsContext.Provider&gt;
  );
}

// 2. Any deep component can grab the function instantly
export const useAppSocket = () =&gt; useContext(WsContext);</code></pre>
        </div>
      </div>
    </div>
  </div>
<!-- üß† TEST YOURSELF QUIZ -->
  <div style="max-width:880px;margin:0 auto;padding:0 24px 32px">
    <div style="background:transparent;border:1px solid rgba(255,255,255,0.06);border-radius:14px;overflow:hidden">
      <div style="padding:14px 18px;border-bottom:1px solid #1f2d45;font-weight:700;font-size:.95rem;color:var(--text);display:flex;align-items:center;justify-content:space-between">
        <span>üß† Test Yourself</span>
        <span id="quiz_9817_score" style="font-size:.8rem;color:#94a3b8">0/2 answered</span>
      </div>
      <div style="padding:18px">
        <div id="quiz_9817_q0" style="margin-bottom:20px">
          <div style="font-size:.88rem;font-weight:600;color:var(--text);margin-bottom:10px">1. In React, where should you open a WebSocket connection?</div>
          <div style="display:flex;flex-direction:column;gap:6px">
            <button id="quiz_9817_q0_o0" onclick="quiz_9817_check(0,0)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">A. In the render function</button>
            <button id="quiz_9817_q0_o1" onclick="quiz_9817_check(0,1)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">B. In useEffect with empty deps []</button>
            <button id="quiz_9817_q0_o2" onclick="quiz_9817_check(0,2)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">C. In useState</button>
            <button id="quiz_9817_q0_o3" onclick="quiz_9817_check(0,3)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">D. In the constructor</button>
          </div>
          <div id="quiz_9817_q0_explain" style="display:none;margin-top:8px;padding:10px 14px;border-radius:8px;font-size:.82rem;line-height:1.6"></div>
        </div>
        <div id="quiz_9817_q1" style="margin-bottom:20px">
          <div style="font-size:.88rem;font-weight:600;color:var(--text);margin-bottom:10px">2. Why use <code>useRef</code> for the WebSocket instead of <code>useState</code>?</div>
          <div style="display:flex;flex-direction:column;gap:6px">
            <button id="quiz_9817_q1_o0" onclick="quiz_9817_check(1,0)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">A. useRef is faster</button>
            <button id="quiz_9817_q1_o1" onclick="quiz_9817_check(1,1)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">B. Changing a ref doesn't trigger a re-render</button>
            <button id="quiz_9817_q1_o2" onclick="quiz_9817_check(1,2)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">C. useState can't store objects</button>
            <button id="quiz_9817_q1_o3" onclick="quiz_9817_check(1,3)" style="text-align:left;padding:10px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#cbd5e1;font-family:Inter,sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='#a78bfa'" onmouseout="this.style.borderColor='#1f2d45'">D. useRef works with TypeScript</button>
          </div>
          <div id="quiz_9817_q1_explain" style="display:none;margin-top:8px;padding:10px 14px;border-radius:8px;font-size:.82rem;line-height:1.6"></div>
        </div>
      </div>
    </div>
  </div>
  <script>
    (function() {
      const answers = [1, 1];
      const explains = ["useEffect with [] runs once on mount ‚Äî perfect for opening a connection that lasts the component's lifetime.", "The WebSocket object changes internally (messages arrive) but you don't want each change to re-render the UI."];
      let answered = new Set();
      let correct = 0;
      window.quiz_9817_check = function(qi, oi) {
        if (answered.has(qi)) return;
        answered.add(qi);
        const isCorrect = oi === answers[qi];
        if (isCorrect) correct++;
        // Style the selected option
        const btn = document.getElementById("quiz_9817_q" + qi + "_o" + oi);
        btn.style.background = isCorrect ? "rgba(34,197,94,.15)" : "rgba(248,113,113,.15)";
        btn.style.borderColor = isCorrect ? "#22c55e" : "#f87171";
        btn.style.color = isCorrect ? "#22c55e" : "#f87171";
        btn.textContent = (isCorrect ? "‚úÖ " : "‚ùå ") + btn.textContent;
        // If wrong, highlight correct answer
        if (!isCorrect) {
          const correctBtn = document.getElementById("quiz_9817_q" + qi + "_o" + answers[qi]);
          correctBtn.style.background = "rgba(34,197,94,.15)";
          correctBtn.style.borderColor = "#22c55e";
          correctBtn.style.color = "#22c55e";
        }
        // Disable all options for this question
        for(let j=0; j<4; j++) {
          const b = document.getElementById("quiz_9817_q" + qi + "_o" + j);
          if(b) b.style.pointerEvents = "none";
        }
        // Show explanation
        const exp = document.getElementById("quiz_9817_q" + qi + "_explain");
        exp.style.display = "block";
        exp.style.background = isCorrect ? "rgba(34,197,94,.08)" : "rgba(248,113,113,.08)";
        exp.style.borderLeft = "3px solid " + (isCorrect ? "#22c55e" : "#f87171");
        exp.style.color = "#cbd5e1";
        exp.innerHTML = (isCorrect ? "‚úÖ Correct! " : "‚ùå Not quite. ") + explains[qi];
        // Update score
        const scoreEl = document.getElementById("quiz_9817_score");
        scoreEl.textContent = correct + "/2 correct";
        if (answered.size === 2) {
          scoreEl.style.color = correct === 2 ? "#22c55e" : correct >= 2 ? "#fbbf24" : "#f87171";
          scoreEl.style.fontWeight = "700";
        }
      };
    })();
  </script>

<!-- ‚ïê‚ïê‚ïê BEGINNER REFERENCE SECTIONS ‚ïê‚ïê‚ïê -->
  <div style="max-width:880px;margin:0 auto;padding:0 24px 32px">
    <!-- üìã Quick Cheat Sheet -->
    <div style="background:transparent;border:1px solid rgba(255,255,255,0.06);border-radius:14px;overflow:hidden;margin-bottom:24px">
      <div style="padding:14px 18px;border-bottom:1px solid #1f2d45;font-weight:700;font-size:.95rem;color:var(--text)">üìã Quick Cheat Sheet ‚Äî WebSocket with React</div>
      <div style="overflow-x:auto">
        <table style="width:100%;border-collapse:collapse;font-size:.83rem">
          <thead><tr><th style="padding:10px 14px;background:rgba(255,255,255,0.02);color:#94a3b8;font-weight:600;font-size:.75rem;text-transform:uppercase;letter-spacing:.4px;border-bottom:1px solid #1f2d45;text-align:left">Code</th><th style="padding:10px 14px;background:rgba(255,255,255,0.02);color:#94a3b8;font-weight:600;font-size:.75rem;text-transform:uppercase;letter-spacing:.4px;border-bottom:1px solid #1f2d45;text-align:left">What it does</th><th style="padding:10px 14px;background:rgba(255,255,255,0.02);color:#94a3b8;font-weight:600;font-size:.75rem;text-transform:uppercase;letter-spacing:.4px;border-bottom:1px solid #1f2d45;text-align:left">When</th></tr></thead>
          <tbody>
            <tr><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:#7dd3fc;font-family:'Fira Code',monospace;font-size:.78rem"><code>useEffect(() =&gt; { ... }, [])</code></td><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:var(--text)">Connect WebSocket once on mount</td><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:#94a3b8;font-size:.78rem">React lifecycle</td></tr>
            <tr><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:#7dd3fc;font-family:'Fira Code',monospace;font-size:.78rem"><code>useRef()</code></td><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:var(--text)">Keep ws reference across renders</td><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:#94a3b8;font-size:.78rem">Survives re-renders</td></tr>
            <tr><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:#7dd3fc;font-family:'Fira Code',monospace;font-size:.78rem"><code>useState([])</code></td><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:var(--text)">Store messages in React state</td><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:#94a3b8;font-size:.78rem">Triggers re-render</td></tr>
            <tr><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:#7dd3fc;font-family:'Fira Code',monospace;font-size:.78rem"><code>return () =&gt; ws.close()</code></td><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:var(--text)">Cleanup on unmount</td><td style="padding:10px 14px;border-bottom:1px solid #1f2d45;color:#94a3b8;font-size:.78rem">In useEffect return</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- üí° Key Takeaways -->
    <div style="background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,0.06);border-radius:14px;padding:18px 20px;margin-bottom:24px">
      <div style="font-weight:700;font-size:.95rem;color:var(--text);margin-bottom:12px">üí° Key Takeaways for Beginners</div>
      <div style="display:flex;gap:10px;align-items:flex-start;margin-bottom:10px;font-size:.86rem;color:#cbd5e1;line-height:1.65"><span style="color:var(--text);flex-shrink:0">‚ñ∏</span><span>In React, open the WebSocket in <code>useEffect</code> with an empty dependency array <code>[]</code> ‚Äî runs once on mount.</span></div>
      <div style="display:flex;gap:10px;align-items:flex-start;margin-bottom:10px;font-size:.86rem;color:#cbd5e1;line-height:1.65"><span style="color:var(--text);flex-shrink:0">‚ñ∏</span><span>Store the WebSocket in a <code>useRef</code> ‚Äî not <code>useState</code> ‚Äî because changing it should NOT cause a re-render.</span></div>
      <div style="display:flex;gap:10px;align-items:flex-start;margin-bottom:10px;font-size:.86rem;color:#cbd5e1;line-height:1.65"><span style="color:var(--text);flex-shrink:0">‚ñ∏</span><span>Store messages in <code>useState</code> so the UI updates when new messages arrive.</span></div>
      <div style="display:flex;gap:10px;align-items:flex-start;margin-bottom:10px;font-size:.86rem;color:#cbd5e1;line-height:1.65"><span style="color:var(--text);flex-shrink:0">‚ñ∏</span><span>Always <strong>close the connection in the cleanup function</strong> (<code>return () => ws.close()</code>) to avoid memory leaks.</span></div>
      <div style="display:flex;gap:10px;align-items:flex-start;margin-bottom:10px;font-size:.86rem;color:#cbd5e1;line-height:1.65"><span style="color:var(--text);flex-shrink:0">‚ñ∏</span><span>Extract this into a custom <code>useWebSocket</code> hook that you can reuse across your entire app.</span></div>
    </div>

  </div>

<div class="nav-bar">
    <a href="index.html" class="nav-btn home">üè† Home</a>
    <a href="learn18.html" class="nav-btn">‚Üê Lesson 18</a>
    <a href="WEBSOCKET_STUDY_NOTES.md" class="nav-btn">üìö Notes</a>
    <a href="learn20.html" class="nav-btn primary">Lesson 20: Socket.io ‚Üí</a>
  </div>
</body>

</html>